'use strict';var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}(function(){var app=angular.module('skykitProvisioning',['ngAnimate','ngCookies','ngSanitize','restangular','ngMaterialDatePicker','ui.router','hSweetAlert','ui.bootstrap','ncy-angular-breadcrumb','directive.g+signin','ngProgress','datetimepicker','ngMaterial','ngclipboard','toastr','angular-cache']);})();(function(){var app=angular.module('skykitProvisioning');app.controller("AdminCtrl",function(AdminService,SessionsService,ToastsService,$mdDialog,DistributorsService){var vm=this;vm.getAllDistributors=function(){vm.loadingAllDistributors=true;var getAllDistributorsPromise=AdminService.getAllDistributors();return getAllDistributorsPromise.then(function(data){vm.loadingAllDistributors=false;return vm.allDistributors=data;});};vm.addUserToDistributor=function(ev,userEmail,distributorAdmin,whichDistributor,form){if(!distributorAdmin){distributorAdmin=false;}var withOrWithout=distributorAdmin?"with":"without";// no option to select distributor is given when there is only one option
if(!whichDistributor){whichDistributor=vm.distributorsAsAdmin[0];}var confirm=$mdDialog.confirm({title:'Are you sure?',textContent:userEmail+' will be added to '+whichDistributor+'\n        '+withOrWithout+' administrator privileges',targetEvent:ev,ok:'Of course!',cancel:'Oops, nevermind.'});return $mdDialog.show(confirm).then(function(){var addUserToDistributorPromise=AdminService.addUserToDistributor(userEmail,whichDistributor,distributorAdmin);addUserToDistributorPromise.then(function(data){ToastsService.showSuccessToast(data.message);vm.user={};form.$setPristine();form.$setUntouched();return setTimeout(function(){return vm.getUsersOfDistributor();},2000);});return addUserToDistributorPromise.catch(function(data){return ToastsService.showErrorToast(data.data.message);});});};vm.makeDistributor=function(ev,distributorName,adminEmail,form){var confirm=$mdDialog.confirm({title:'Are you sure?',textContent:'If you proceed, '+distributorName+' will be created.',targetEvent:ev,ariaLabel:'Lucky day',ok:'Yeah!',cancel:'Forget it.'});return $mdDialog.show(confirm).then(function(){var makeDistributorPromise=AdminService.makeDistributor(distributorName,adminEmail);makeDistributorPromise.then(function(data){vm.distributor={};form.$setPristine();form.$setUntouched();ToastsService.showSuccessToast(data.message);return setTimeout(function(){return vm.allDistributors=vm.getAllDistributors();},2000);});return makeDistributorPromise.catch(function(data){return ToastsService.showErrorToast(data.data.message);});});};vm.getUsersOfDistributor=function(){vm.loadingUsersOfDistributor=true;var currentDistributorKey=SessionsService.getCurrentDistributorKey();var usersofDistributorPromise=AdminService.getUsersOfDistributor(currentDistributorKey);return usersofDistributorPromise.then(function(data){vm.loadingUsersOfDistributor=false;return vm.usersOfDistributor=data;});};vm.switchDistributor=function(distributor){DistributorsService.switchDistributor(distributor);return ToastsService.showSuccessToast('Distributor '+distributor.name+' selected!');};vm.initialize=function(){vm.getUsersOfDistributor();vm.getAllDistributors();vm.isAdmin=SessionsService.getIsAdmin();vm.distributorsAsAdmin=SessionsService.getDistributorsAsAdmin();vm.currentDistributorName=SessionsService.getCurrentDistributorName();if(vm.isAdmin){return vm.getAllDistributors();}};return vm;});})();(function(){var app=angular.module('skykitProvisioning');app.controller("AuthenticationCtrl",function($scope,$log,$state,$timeout,identity,sweet,SessionsService,ProgressBarService,ProofPlayService,DevicesService,TenantsService){var vm=this;vm.onGooglePlusSignInSuccess=function(event,authResult){if(!vm.googlePlusSignInButtonClicked){ProgressBarService.start();}var promise=SessionsService.login(authResult);return promise.then(vm.loginSuccess,vm.loginFailure);};vm.onGooglePlusSignInFailure=function(event,authResult){if(vm.googlePlusSignInButtonClicked){ProgressBarService.complete();return sweet.show('Oops...','Unable to authenticate to Google+.','error');}};$scope.$on('event:google-plus-signin-success',vm.onGooglePlusSignInSuccess);$scope.$on('event:google-plus-signin-failure',vm.onGooglePlusSignInFailure);vm.initializeSignIn=function(){vm.clientId=identity.OAUTH_CLIENT_ID;vm.state=identity.STATE;return vm.googlePlusSignInButtonClicked=false;};vm.initializeSignOut=function(){SessionsService.removeUserInfo();return $timeout(vm.proceedToSignedOut,50);};vm.loginSuccess=function(response){ProgressBarService.complete();ProofPlayService.proofplayCache.removeAll();TenantsService.tenantCache.removeAll();DevicesService.deviceCache.removeAll();DevicesService.deviceByTenantCache.removeAll();return $state.go('distributor_selection');};vm.loginFailure=function(){ProgressBarService.complete();return sweet.show('Oops...','Unable to authenticate to Stormpath.','error');};vm.proceedToSignedOut=function(){return $state.go('signed_out');};vm.proceedToSignIn=function(){return $state.go('sign_in');};vm.onClickGooglePlusSignIn=function(){vm.googlePlusSignInButtonClicked=true;return ProgressBarService.start();};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('AppController',function($mdSidenav,$state,$window,SessionsService){var vm=this;vm.identity={};vm.currentDistributerInDistributerAdminList=function(){var currentDistributorName=SessionsService.getCurrentDistributorName();var distributorsAsAdmin=SessionsService.getDistributorsAsAdmin();return _.contains(distributorsAsAdmin,currentDistributorName);};vm.getIdentity=function(){return vm.identity={key:SessionsService.getUserKey(),email:SessionsService.getUserEmail(),admin:SessionsService.getIsAdmin(),distributor_admin:SessionsService.getDistributorsAsAdmin(),admin_of_current_distributor:vm.currentDistributerInDistributerAdminList(),distributorKey:SessionsService.getCurrentDistributorKey(),distributorName:SessionsService.getCurrentDistributorName()};};vm.isCurrentURLDistributorSelector=function(){var result=void 0;var test=$window.location.href.search(/distributor_selection/);return result=test>=0;};vm.initialize=function(){return vm.getIdentity();};vm.toggleSidenav=function(){return $mdSidenav('left').toggle();};vm.goTo=function(stateName,id){$state.go(stateName,{id:id});if($mdSidenav('left').isOpen()){return $mdSidenav('left').close();}};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('DeviceDetailsCommandsCtrl',function($log,$stateParams,$state,SessionsService,DevicesService,LocationsService,CommandsService,TimezonesService,sweet,ProgressBarService,$mdDialog,ToastsService,$timeout){var vm=this;vm.tenantKey=$stateParams.tenantKey;vm.deviceKey=$stateParams.deviceKey;vm.fromDevices=$stateParams.fromDevices==="true";vm.currentDevice={};vm.commandEvents=[];vm.generateLocalFromUTC=function(UTCTime){var localTime=moment.utc(UTCTime).toDate();return localTime=moment(localTime).format('YYYY-MM-DD hh:mm:ss A');};vm.replaceCommandTime=function(issues){for(var i=0;i<issues.length;i++){var each=issues[i];if(each.postedTime){each.postedTime=vm.generateLocalFromUTC(each.postedTime);}if(each.confirmedTime){each.confirmedTime=vm.generateLocalFromUTC(each.confirmedTime);}}return;};vm.getEvents=function(deviceKey,prev,next){ProgressBarService.start();var commandEventsPromise=DevicesService.getCommandEventsByKey(deviceKey,prev,next);return commandEventsPromise.then(function(data){vm.replaceCommandTime(data.events);vm.event_next_cursor=data.next_cursor;vm.event_prev_cursor=data.prev_cursor;vm.commandEvents=data.events;return ProgressBarService.complete();});};vm.getEventsTimeOut=function(deviceKey,prev,next){return $timeout(function(){return vm.getEvents(deviceKey,prev,next);},1000);};vm.commandHistorySelected=function(){return vm.getEvents(vm.deviceKey);};vm.paginateEventCall=function(forward){if(forward){return vm.getEvents(vm.deviceKey,null,vm.event_next_cursor);}else{return vm.getEvents(vm.deviceKey,vm.event_prev_cursor,null);}};vm.initialize=function(){var devicePromise=DevicesService.getDeviceByKey(vm.deviceKey);devicePromise.then(function(response){return vm.onGetDeviceSuccess(response);},function(response){return vm.onGetDeviceFailure(response);});return vm.getEvents(vm.deviceKey);};vm.onGetDeviceSuccess=function(response){vm.currentDevice=response;if(response.timezone!==vm.selectedTimezone){vm.selectedTimezone=response.timezone;}if(vm.tenantKey===undefined){vm.tenantKey=vm.currentDevice.tenantKey;}if($stateParams.fromDevices==="true"){vm.backUrl='/#/devices';return vm.backUrlText='Back to devices';}else{if(vm.currentDevice.isUnmanagedDevice===true){vm.backUrl='/#/tenants/'+vm.tenantKey+'/unmanaged';return vm.backUrlText='Back to tenant unmanaged devices';}else{vm.backUrl='/#/tenants/'+vm.tenantKey+'/managed';return vm.backUrlText='Back to tenant managed devices';}}};vm.onGetDeviceFailure=function(response){ToastsService.showErrorToast('Oops. We were unable to fetch the details for this device at this time.');var errorMessage='No detail for device_key #'+vm.deviceKey+'. Error: '+response.status+' '+response.statusText;$log.error(errorMessage);return $state.go('devices');};vm.onResetContent=function(){ProgressBarService.start();var promise=CommandsService.contentDelete(vm.deviceKey);return promise.then(vm.onResetContentSuccess,vm.onResetContentFailure);};vm.onResetContentSuccess=function(){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast("We posted your reset content command into the player's queue.");};vm.onResetContentFailure=function(error){ProgressBarService.complete();$log.error('Reset content command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your reset content command into the player's queue.",'error');};vm.onUpdateContent=function(){ProgressBarService.start();var promise=CommandsService.contentUpdate(vm.deviceKey);return promise.then(vm.onUpdateContentSuccess,vm.onUpdateContentFailure);};vm.onUpdateContentSuccess=function(){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast("We posted your update content command into the player's queue.");};vm.onUpdateContentFailure=function(error){ProgressBarService.complete();$log.error('Content update command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your update content command into the player's queue.",'error');};vm.onResetPlayer=function(){ProgressBarService.start();var promise=CommandsService.reset(vm.deviceKey);return promise.then(vm.onResetPlayerSuccess,vm.onResetPlayerFailure);};vm.onResetPlayerSuccess=function(){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast("We posted your reset player command into the player's queue.");};vm.onResetPlayerFailure=function(error){ProgressBarService.complete();$log.error('Reset player command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your reset player command into the player's queue.",'error');};vm.onPanelOn=function(){ProgressBarService.start();var promise=CommandsService.powerOn(vm.deviceKey);return promise.then(vm.onPanelOnSuccess,vm.onPanelOnFailure);};vm.onPanelOnSuccess=function(){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast("We posted your panel on command into the player's queue.");};vm.onPanelOnFailure=function(error){ProgressBarService.complete();$log.error('Panel on command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your panel on command into the player's queue.",'error');};vm.onPanelOff=function(){ProgressBarService.start();var promise=CommandsService.powerOff(vm.deviceKey);return promise.then(vm.onPanelOffSuccess,vm.onPanelOffFailure);};vm.onPanelOffSuccess=function(){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast("We posted your panel off command into the player's queue.");};vm.onPanelOffFailure=function(error){ProgressBarService.complete();$log.error('Panel off command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your panel off command into the player's queue.",'error');};vm.onUpdateDevice=function(){ProgressBarService.start();var promise=CommandsService.updateDevice(vm.deviceKey);return promise.then(vm.onUpdateDeviceSuccess,vm.onUpdateDeviceFailure);};vm.onUpdateDeviceSuccess=function(){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast("We posted your update device command into the player's queue.");};vm.onUpdateDeviceFailure=function(error){ProgressBarService.complete();$log.error('Update device command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your update device command into the player's queue.",'error');};vm.onVolumeChange=function(){ProgressBarService.start();var promise=CommandsService.volume(vm.deviceKey,vm.currentDevice.volume);return promise.then(vm.onVolumeChangeSuccess(vm.currentDevice.volume),vm.onVolumeChangeFailure);};vm.onVolumeChangeSuccess=function(level){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast('We posted your volume change command of '+level+' into the player\'s queue.');};vm.onVolumeChangeFailure=function(error){ProgressBarService.complete();$log.error('Volume change command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your volume change command into the player's queue.",'error');};vm.onCustomCommand=function(){ProgressBarService.start();var promise=CommandsService.custom(vm.deviceKey,vm.currentDevice.custom);return promise.then(vm.onCustomCommandSuccess(vm.currentDevice.custom),vm.onCustomCommandFailure);};vm.onCustomCommandSuccess=function(command){ProgressBarService.complete();vm.getEventsTimeOut(vm.deviceKey);return ToastsService.showSuccessToast('We posted your custom command \''+command+'\' into the player\'s queue.');};vm.onCustomCommandFailure=function(error){ProgressBarService.complete();$log.error('Custom command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your custom command into the player's queue.",'error');};vm.onDiagnosticsToggle=function(){ProgressBarService.start();var promise=CommandsService.toggleDiagnostics(vm.deviceKey);return promise.then(vm.onToggleDiagnosticsSuccess,vm.onToggleDiagnosticsFailure);};vm.onToggleDiagnosticsSuccess=function(){ProgressBarService.complete();return ToastsService.showSuccessToast("We posted your diagnostics command into the player's queue.");};vm.onToggleDiagnosticsFailure=function(error){ProgressBarService.complete();$log.error('Diagnostics command error: '+error.status+' '+error.statusText);return sweet.show('Oops...',"We were unable to post your diagnostics command into the player's queue.",'error');};return vm;});})();(function(){function DeviceDetailsCtrl($log,$stateParams,$state,SessionsService,DevicesService,LocationsService,CommandsService,TimezonesService,IntegrationEvents,sweet,ProgressBarService,$mdDialog,ToastsService,DateManipulationService){var vm=this;vm.tenantKey=$stateParams.tenantKey;vm.deviceKey=$stateParams.deviceKey;vm.fromDevices=$stateParams.fromDevices==="true";vm.currentDevice={};vm.locations=[];vm.commandEvents=[];vm.dayRange=30;vm.issues=[];vm.timezones=[];vm.selectedTimezone=undefined;var _DateManipulationServ=DateManipulationService.createFormattedStartAndEndDateFromToday(30);var _DateManipulationServ2=_slicedToArray(_DateManipulationServ,2);vm.startTime=_DateManipulationServ2[0];vm.endTime=_DateManipulationServ2[1];vm.enrollmentEvents=[];vm.replaceIssueTime=function(issues){for(var i=0;i<issues.length;i++){var each=issues[i];if(each.created){each.created=DateManipulationService.generateLocalFromUTC(each.created);}if(each.updated){each.updated=DateManipulationService.generateLocalFromUTC(each.updated);}}return;};vm.replaceCommandTime=function(issues){for(var i=0;i<issues.length;i++){var each=issues[i];if(each.postedTime){each.postedTime=DateManipulationService.generateLocalFromUTC(each.postedTime);}if(each.confirmedTime){each.confirmedTime=DateManipulationService.generateLocalFromUTC(each.confirmedTime);}}return;};vm.copyDeviceKey=function(){return ToastsService.showSuccessToast('Device key copied to your clipboard');};vm.copyCorrelationIdentifier=function(){return ToastsService.showSuccessToast('Correlation ID copied to your clipboard');};// event tab
vm.getIssues=function(device,epochStart,epochEnd,prev,next){ProgressBarService.start();var issuesPromise=DevicesService.getIssuesByKey(device,epochStart,epochEnd,prev,next);return issuesPromise.then(function(data){vm.replaceIssueTime(data.issues);vm.issues=data.issues;vm.prev_cursor=data.prev;vm.next_cursor=data.next;return ProgressBarService.complete();});};// command history tab
vm.getEvents=function(deviceKey,prev,next){ProgressBarService.start();var commandEventsPromise=DevicesService.getCommandEventsByKey(deviceKey,prev,next);return commandEventsPromise.then(function(data){vm.replaceCommandTime(data.events);vm.event_next_cursor=data.next_cursor;vm.event_prev_cursor=data.prev_cursor;vm.commandEvents=data.events;return ProgressBarService.complete();});};// enrollment tab
vm.getEnrollmentEvents=function(deviceKey){ProgressBarService.start();var commandEventsPromise=IntegrationEvents.getEnrollmentEvents(deviceKey);return commandEventsPromise.then(function(data){vm.enrollmentEvents=data;return ProgressBarService.complete();});};vm.paginateCall=function(forward){if(forward){return vm.getIssues(vm.deviceKey,vm.epochStart,vm.epochEnd,null,vm.next_cursor);}else{return vm.getIssues(vm.deviceKey,vm.epochStart,vm.epochEnd,vm.prev_cursor,null);}};vm.paginateEventCall=function(forward){if(forward){return vm.getEvents(vm.deviceKey,null,vm.event_next_cursor);}else{return vm.getEvents(vm.deviceKey,vm.event_prev_cursor,null);}};vm.initialize=function(){vm.epochStart=moment(vm.startTime,'YYYY-MM-DD hh:mm A').unix();vm.epochEnd=moment(vm.endTime,'YYYY-MM-DD hh:mm A').unix();var timezonePromise=TimezonesService.getCustomTimezones();timezonePromise.then(function(data){return vm.timezones=data;});vm.panelModels=DevicesService.getPanelModels();vm.panelInputs=DevicesService.getPanelInputs();var devicePromise=DevicesService.getDeviceByKey(vm.deviceKey);devicePromise.then(function(response){return vm.onGetDeviceSuccess(response);},function(response){return vm.onGetDeviceFailure(response);});vm.getEvents(vm.deviceKey);vm.getIssues(vm.deviceKey,vm.epochStart,vm.epochEnd);return vm.getEnrollmentEvents(vm.deviceKey);};vm.onGetDeviceSuccess=function(response){vm.currentDevice=response;if(response.timezone!==vm.selectedTimezone){vm.selectedTimezone=response.timezone;}if(vm.tenantKey===undefined){vm.tenantKey=vm.currentDevice.tenantKey;}if($stateParams.fromDevices==="true"){vm.backUrl='/#/devices';vm.backUrlText='Back to devices';}else{if(vm.currentDevice.isUnmanagedDevice===true){vm.backUrl='/#/tenants/'+vm.tenantKey+'/unmanaged';vm.backUrlText='Back to tenant unmanaged devices';}else{vm.backUrl='/#/tenants/'+vm.tenantKey+'/managed';vm.backUrlText='Back to tenant managed devices';}}var locationsPromise=LocationsService.getLocationsByTenantKey(vm.tenantKey);return locationsPromise.then(function(data){vm.locations=data;return vm.setSelectedOptions();});};vm.onGetDeviceFailure=function(response){ToastsService.showErrorToast('Oops. We were unable to fetch the details for this device at this time.');var errorMessage='No detail for device_key #'+vm.deviceKey+'. Error: '+response.status+' '+response.statusText;$log.error(errorMessage);return $state.go('devices');};vm.setSelectedOptions=function(){if(vm.currentDevice.panelModel===null){vm.currentDevice.panelModel=vm.panelModels[0];vm.currentDevice.panelInput=vm.panelInputs[0];}else{for(var i=0;i<vm.panelModels.length;i++){var panelModel=vm.panelModels[i];if(panelModel.id===vm.currentDevice.panelModel){vm.currentDevice.panelModel=panelModel;}}for(var j=0;j<vm.panelInputs.length;j++){var panelInput=vm.panelInputs[j];var isParent=panelInput.parentId===vm.currentDevice.panelModel.id;if(isParent&&panelInput.id.toLowerCase()===vm.currentDevice.panelInput){vm.currentDevice.panelInput=panelInput;}}}if(vm.currentDevice.locationKey!==null){for(var k=0;k<vm.locations.length;k++){var location=vm.locations[k];if(location.key===vm.currentDevice.locationKey){vm.currentDevice.location=location;}}return;}};//####################
// Properties Tab
//####################
vm.onSaveDevice=function(){ProgressBarService.start();if(vm.currentDevice.location!==undefined&&vm.currentDevice.location.key!==undefined){vm.currentDevice.locationKey=vm.currentDevice.location.key;}if(vm.currentDevice.panelModel.id!==undefined&&vm.currentDevice.panelModel.id!=='None'){vm.currentDevice.panelModelNumber=vm.currentDevice.panelModel.id;}if(vm.currentDevice.panelInput.id!==undefined&&vm.currentDevice.panelInput.id!=='None'){vm.currentDevice.panelSerialInput=vm.currentDevice.panelInput.id.toLowerCase();}vm.currentDevice.timezone=vm.selectedTimezone;var promise=DevicesService.save(vm.currentDevice);return promise.then(vm.onSuccessDeviceSave,vm.onFailureDeviceSave);};vm.onSuccessDeviceSave=function(){ProgressBarService.complete();return ToastsService.showSuccessToast('We saved your update.');};vm.onFailureDeviceSave=function(error){ProgressBarService.complete();if(error.status===409){$log.info('Failure saving device. Customer display code already exists for tenant: '+error.status+' '+error.statusText);return sweet.show('Oops...','This customer display code already exists for this tenant. Please choose another.','error');}else{$log.error('Failure saving device: '+error.status+' '+error.statusText);return ToastsService.showErrorToast('Oops. We were unable to save your updates to this device at this time.');}};vm.confirmDeviceDelete=function(event,key){var confirm=$mdDialog.confirm({title:'Are you sure to delete this device?',textContent:'Please remember, you MUST remove this device from Content Manager before deleting it from Provisioning.',targetEvent:event,ok:'Delete',cancel:'Cancel'});var showPromise=$mdDialog.show(confirm);var success=function success(){return vm.onConfirmDelete(key);};var failure=function failure(){return vm.onConfirmCancel();};return showPromise.then(success,failure);};vm.onConfirmDelete=function(key){var success=function success(){ToastsService.showSuccessToast('We processed your delete request.');return $state.go('devices');};var failure=function failure(error){var friendlyMessage='We were unable to complete your delete request at this time.';ToastsService.showErrorToast(friendlyMessage);return $log.error('Delete device failure for device_key '+key+': '+error.status+' '+error.statusText);};var deletePromise=DevicesService.delete(key);return deletePromise.then(success,failure);};vm.onConfirmCancel=function(){return ToastsService.showInfoToast('We canceled your delete request.');};vm.onProofOfPlayLoggingCheck=function(){if(vm.currentDevice.proofOfPlayLogging){var noLocation=vm.currentDevice.locationKey===null;var noDisplayCode=vm.currentDevice.customerDisplayCode===null;if(noLocation){sweet.show('Oops...',"You must have a Location to enable Proof of play.",'error');return vm.currentDevice.proofOfPlayLogging=false;}else if(noDisplayCode){sweet.show('Oops...',"You must have a Display code to enable Proof of play.",'error');return vm.currentDevice.proofOfPlayLogging=false;}else{return vm.onSaveDevice();}}else{return vm.onSaveDevice();}};vm.onUpdateLocation=function(){return vm.onSaveDevice();};vm.autoGenerateCustomerDisplayCode=function(){var newDisplayCode='';if(vm.currentDevice.customerDisplayName){newDisplayCode=vm.currentDevice.customerDisplayName.toLowerCase();newDisplayCode=newDisplayCode.replace(/\s+/g,'_');newDisplayCode=newDisplayCode.replace(/\W+/g,'');}return vm.currentDevice.customerDisplayCode=newDisplayCode;};vm.logglyForUser=function(){var userDomain=SessionsService.getUserEmail().split("@")[1];return userDomain==="demo.agosto.com"||userDomain==="agosto.com";};vm.onClickRefreshButton=function(){ProgressBarService.start();vm.startTime=DateManipulationService.convertToMomentIfNotAlready(vm.startTime);vm.endTime=DateManipulationService.convertToMomentIfNotAlready(vm.endTime);vm.epochStart=moment(vm.startTime,'YYYY-MM-DD hh:mm A').unix();vm.epochEnd=moment(vm.endTime,'YYYY-MM-DD hh:mm A').unix();vm.prev_cursor=null;vm.next_cursor=null;var issuesPromise=DevicesService.getIssuesByKey(vm.deviceKey,vm.epochStart,vm.epochEnd,vm.prev_cursor,vm.next_cursor);return issuesPromise.then(function(data){return vm.onRefreshIssuesSuccess(data);},function(error){return vm.onRefreshIssuesFailure(error);});};vm.onRefreshIssuesSuccess=function(data){vm.replaceIssueTime(data.issues);vm.issues=data.issues;vm.prev_cursor=data.prev;vm.next_cursor=data.next;return ProgressBarService.complete();};vm.onRefreshIssuesFailure=function(error){ProgressBarService.complete();ToastsService.showInfoToast('We were unable to refresh the device issues list at this time.');return $log.error('Failure to refresh device issues: '+error.status+' '+error.statusText);};return vm;}angular.module('skykitProvisioning').controller('DeviceDetailsCtrl',DeviceDetailsCtrl);})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('DevicesListingCtrl',function($stateParams,$log,DevicesService,$state,SessionsService,ProgressBarService,sweet){var vm=this;vm.distributorKey=undefined;//####################################
// Managed
//####################################
vm.devices=[];vm.devicesPrev=null;vm.devicesNext=null;vm.selectedButton="Serial Number";vm.serialDevices={};vm.disabled=true;vm.macDevices={};//####################################
// Unmanaged
//####################################
vm.unmanagedSelectedButton="MAC";vm.unmanagedSerialDevices={};vm.unmanagedDisabled=true;vm.unmanagedDevicesPrev=null;vm.unmanagedDevicesNext=null;vm.unmanagedDevices=[];vm.unmanagedMacDevices={};vm.refreshManagedDevices=function(){vm.devicesPrev=null;vm.devicesNext=null;DevicesService.deviceCache.removeAll();return vm.getManagedDevices(vm.distributorKey,vm.devicesPrev,vm.devicesNext);};vm.refreshUnmanagedDevices=function(){vm.unmanagedDevicesPrev=null;vm.unmanagedDevicesNext=null;DevicesService.deviceCache.removeAll();return vm.getUnmanagedDevices(vm.distributorKey,vm.unmanagedDevicesPrev,vm.unmanagedDevicesNext);};vm.changeRadio=function(unmanaged){if(unmanaged){vm.unmanagedSearchText='';vm.unmanagedDisabled=true;vm.unmanagedSerialDevices={};return vm.unmanagedMacDevices={};}else{vm.searchText='';vm.disabled=true;vm.serialDevices={};return vm.macDevices={};}};vm.convertArrayToDictionary=function(theArray,mac){var devices={};for(var i=0;i<theArray.length;i++){var item=theArray[i];if(mac){devices[item.mac]=item;}else{devices[item.serial]=item;}}return devices;};vm.prepareForEditView=function(unmanaged,searchText){if(unmanaged){var mac=vm.unmanagedSelectedButton==="MAC";if(mac){return vm.editItem(vm.unmanagedMacDevices[searchText]);}else{return vm.editItem(vm.unmanagedSerialDevices[searchText]);}}else{var mac=vm.selectedButton==="MAC";if(mac){return vm.editItem(vm.macDevices[searchText]);}else{return vm.editItem(vm.serialDevices[searchText]);}}};vm.controlOpenButton=function(unmanaged,isMatch){if(!unmanaged){vm.disabled=!isMatch;return vm.disabledButtonLoading=false;}else{vm.unmanagedDisabled=!isMatch;return vm.unmanagedDisabledButtonLoading=false;}};vm.isResourceValid=function(unmanaged,resource){if(resource){if(resource.length>2){if(unmanaged){var mac=vm.unmanagedSelectedButton==="MAC";vm.unmanagedDisabledButtonLoading=true;}else{var mac=vm.selectedButton==="MAC";vm.disabledButtonLoading=true;}if(mac){return DevicesService.matchDevicesByFullMac(vm.distributorKey,resource,unmanaged).then(function(res){return vm.controlOpenButton(unmanaged,res["is_match"]);});}else{return DevicesService.matchDevicesByFullSerial(vm.distributorKey,resource,unmanaged).then(function(res){return vm.controlOpenButton(unmanaged,res["is_match"]);});}}else{return vm.controlOpenButton(unmanaged,false);}}else{return vm.controlOpenButton(unmanaged,false);}};vm.searchDevices=function(unmanaged,partial){if(partial){if(partial.length>2){if(unmanaged){var button=vm.unmanagedSelectedButton;}else{var button=vm.selectedButton;}if(button==="Serial Number"){return DevicesService.searchDevicesByPartialSerial(vm.distributorKey,partial,unmanaged).then(function(res){var result=res["serial_number_matches"];if(unmanaged){vm.unmanagedSerialDevices=vm.convertArrayToDictionary(result,false);}else{vm.serialDevices=vm.convertArrayToDictionary(result,false);}var serialDevices=[];for(var i=0;i<result.length;i++){var each=result[i];serialDevices.push(each.serial);}return serialDevices;});}else{return DevicesService.searchDevicesByPartialMac(vm.distributorKey,partial,unmanaged).then(function(res){var result=res["mac_matches"];if(unmanaged){vm.unmanagedMacDevices=vm.convertArrayToDictionary(result,true);}else{vm.macDevices=vm.convertArrayToDictionary(result,true);}var macDevices=[];for(var i=0;i<result.length;i++){var each=result[i];macDevices.push(each.mac);}return macDevices;});}}else{return[];}}else{return[];}};vm.getManagedDevices=function(key,prev,next){ProgressBarService.start();var devicesPromise=DevicesService.getDevicesByDistributor(key,prev,next);return devicesPromise.then(function(response){vm.devices=response.devices;vm.devicesNext=response.next_cursor;vm.devicesPrev=response.prev_cursor;return vm.getFetchSuccess();},function(response){return vm.getFetchFailure(response);});};vm.getUnmanagedDevices=function(key,prev,next){ProgressBarService.start();var unmanagedDevicesPromise=DevicesService.getUnmanagedDevicesByDistributor(key,prev,next);return unmanagedDevicesPromise.then(function(response){vm.unmanagedDevices=response.devices;vm.unmanagedDevicesPrev=response.prev_cursor;vm.unmanagedDevicesNext=response.next_cursor;return vm.getFetchSuccess();},function(response){return vm.getFetchFailure(response);});};vm.initialize=function(){vm.distributorKey=SessionsService.getCurrentDistributorKey();vm.getManagedDevices(vm.distributorKey,vm.devicesPrev,vm.devicesNext);return vm.getUnmanagedDevices(vm.distributorKey,vm.unmanagedDevicesPrev,vm.unmanagedDevicesNext);};vm.getFetchSuccess=function(){return ProgressBarService.complete();};vm.getFetchFailure=function(response){ProgressBarService.complete();var errorMessage='Unable to fetch devices. Error: '+response.status+' '+response.statusText+'.';return sweet.show('Oops...',errorMessage,'error');};vm.editItem=function(item){return $state.go('editDevice',{deviceKey:item.key,tenantKey:item.tenantKey,fromDevices:true});};vm.paginateCall=function(forward,managed){if(forward){if(managed){vm.getManagedDevices(vm.distributorKey,null,vm.devicesNext);}if(!managed){vm.getUnmanagedDevices(vm.distributorKey,null,vm.unmanagedDevicesNext);}}if(!forward){if(managed){vm.getManagedDevices(vm.distributorKey,vm.devicesPrev,null);}if(!managed){return vm.getUnmanagedDevices(vm.distributorKey,vm.unmanagedDevicesPrev,null);}}};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("DistributorSelectorCtrl",function($log,$state,DistributorsService,SessionsService){var vm=this;vm.distributors=[];vm.currentDistributor=undefined;vm.loading=true;vm.initialize=function(){vm.loading=true;var distributorsPromise=DistributorsService.fetchAllByUser(SessionsService.getUserKey());return distributorsPromise.then(function(data){vm.distributors=data;if(vm.distributors.length===1){return vm.selectDistributor(vm.distributors[0]);}else{return vm.loading=false;}});};vm.selectDistributor=function(distributor){return DistributorsService.switchDistributor(distributor);};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("DistributorsCtrl",function($state){var vm=this;vm.distributors=[];return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('DomainDetailsCtrl',function($log,$stateParams,DistributorsService,DomainsService,$state,sweet,ProgressBarService,ToastsService,SessionsService){var vm=this;vm.currentDomain={key:undefined,name:undefined,impersonation_admin_email_address:undefined,distributor_key:undefined,active:true};vm.currentDomains=[];vm.editMode=!!$stateParams.domainKey;if(vm.editMode){var domainPromise=DomainsService.getDomainByKey($stateParams.domainKey);domainPromise.then(function(data){return vm.currentDomain=data;});}else{vm.currentDomain.distributor_key=SessionsService.getCurrentDistributorKey();}vm.onSaveDomain=function(){ProgressBarService.start();var promise=DomainsService.save(vm.currentDomain);return promise.then(vm.onSuccessSaveDomain,vm.onFailureSaveDomain);};vm.onSuccessSaveDomain=function(){ProgressBarService.complete();return ToastsService.showSuccessToast('We saved your update.');};vm.onFailureSaveDomain=function(error){ProgressBarService.complete();if(error.status===409){$log.info('Failure saving domain. Domain already exists: '+error.status+' '+error.statusText);return sweet.show('Oops...','This domain name already exist. Please enter a unique domain name.','error');}else{$log.error('Failure saving domain: '+error.status+' '+error.statusText);return ToastsService.showErrorToast('Oops. We were unable to save your updates at this time.');}};vm.editItem=function(item){return $state.go('editDomain',{domainKey:item.key});};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("DomainsCtrl",function($state,$log,DomainsService,sweet){var vm=this;vm.domains=[];vm.initialize=function(){var promise=DomainsService.fetchAllDomains();return promise.then(function(data){return vm.domains=data;});};vm.editItem=function(item){return $state.go('editDomain',{domainKey:item.key});};vm.deleteItem=function(item){var callback=function callback(){var promise=DomainsService.delete(item);return promise.then(function(){return vm.initialize();});};return sweet.show({title:"Are you sure?",text:"This will permanently remove the domain from the distributor and disconnect from tenants.",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, remove the domain!",closeOnConfirm:true},callback);};return vm;});})();(function(){var app=angular.module('skykitProvisioning');app.config(function(toastrConfig){return angular.extend(toastrConfig,{progressBar:true,closeButton:true,tapToDismiss:true,newestOnTop:true,positionClass:'toast-bottom-left',timeOut:5000});});app.config(function($breadcrumbProvider){return $breadcrumbProvider.setOptions({prefixStateName:'home',template:'bootstrap3'});});})();(function(){var app=angular.module('skykitProvisioning');app.config(function($stateProvider,$urlRouterProvider,RestangularProvider){$stateProvider.state("sign_in",{resolve:{identity:function identity(IdentityService){return IdentityService.getIdentity();},notAuthenticated:function notAuthenticated(AuthorizationService){return AuthorizationService.notAuthenticated();}},url:"/sign_in",templateUrl:"app/authentication/sign_in.html",controller:"AuthenticationCtrl",controllerAs:'authenticationCtrl'});$stateProvider.state("signed_out",{url:"/signed_out",resolve:{identity:function identity(IdentityService){return IdentityService.getIdentity();},notAuthenticated:function notAuthenticated(AuthorizationService){return AuthorizationService.notAuthenticated();}},templateUrl:"app/authentication/signed_out.html",controller:"AuthenticationCtrl",controllerAs:'authenticationCtrl'});$stateProvider.state("sign_out",{resolve:{identity:function identity(IdentityService){return IdentityService.getIdentity();},authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/sign_out",templateUrl:"app/authentication/sign_out.html",controller:"AuthenticationCtrl",controllerAs:'authenticationCtrl'});$stateProvider.state("distributor_selection",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/distributor_selection",templateUrl:"app/distributor/distributor_selector.html",controller:"DistributorSelectorCtrl",controllerAs:'vm'});$stateProvider.state("home",{url:"/",templateUrl:"app/welcome/welcome.html",resolve:{identity:function identity(IdentityService){return IdentityService.getIdentity();},authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},controller:"WelcomeCtrl",controllerAs:'welcomeCtrl',ncyBreadcrumb:{label:'Skykit Provisioning'}});$stateProvider.state("welcome",{url:"/welcome",templateUrl:"app/welcome/welcome.html",resolve:{identity:function identity(IdentityService){return IdentityService.getIdentity();},authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},controller:"WelcomeCtrl",controllerAs:'welcomeCtrl',ncyBreadcrumb:{label:'Skykit Provisioning'}});$stateProvider.state("domains",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/domains",templateUrl:"app/domain/domains-listing.html",controller:"DomainsCtrl",controllerAs:'domainsCtrl',ncyBreadcrumb:{label:'Domains'}});$stateProvider.state("addDomain",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/domains/add",templateUrl:"app/domain/domain-detail.html",controller:"DomainDetailsCtrl",controllerAs:'domainDetailsCtrl',ncyBreadcrumb:{label:'Add domain',parent:'domains'}});$stateProvider.state("editDomain",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/domains/:domainKey",templateUrl:"app/domain/domain-detail.html",controller:"DomainDetailsCtrl",controllerAs:'domainDetailsCtrl',ncyBreadcrumb:{label:'{{ domainDetailsCtrl.currentDomain.name }}',parent:'domains'}});$stateProvider.state("tenants",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants",templateUrl:"app/tenant/tenants-listing.html",controller:"TenantsCtrl",controllerAs:'tenantsCtrl',ncyBreadcrumb:{label:'Tenants'}});$stateProvider.state("addTenant",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants/add",templateUrl:"app/tenant/tenant-add.html",controller:"TenantAddCtrl",controllerAs:'tenantAddCtrl',ncyBreadcrumb:{label:'Add tenant',parent:'tenants'}});$stateProvider.state("tenantDetails",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants/:tenantKey/details",templateUrl:"app/tenant/tenant-details.html",controller:"TenantDetailsCtrl",controllerAs:'tenantDetailsCtrl',ncyBreadcrumb:{label:'{{ tenantDetailsCtrl.currentTenant.name }}',parent:'tenants'}});$stateProvider.state("tenantManagedDevices",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants/:tenantKey/managed",templateUrl:"app/tenant/tenant-managed-devices.html",controller:"TenantManagedDevicesCtrl",controllerAs:'tenantManagedDevicesCtrl',ncyBreadcrumb:{label:'{{ tenantManagedDevicesCtrl.currentTenant.name }}',parent:'tenants'}});$stateProvider.state("tenantUnmanagedDevices",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants/:tenantKey/unmanaged",templateUrl:"app/tenant/tenant-unmanaged-devices.html",controller:"TenantUnmanagedDevicesCtrl",controllerAs:'tenantUnmanagedDevicesCtrl',ncyBreadcrumb:{label:'{{ tenantUnmanagedDevicesCtrl.currentTenant.name }}',parent:'tenants'}});$stateProvider.state("tenantLocations",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants/:tenantKey/locations",templateUrl:"app/tenant/tenant-locations.html",controller:"TenantLocationsCtrl",controllerAs:'tenantLocationsCtrl',ncyBreadcrumb:{label:'{{ tenantLocationsCtrl.currentTenant.name }}',parent:'tenants'}});$stateProvider.state("editLocation",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/locations/:locationKey",templateUrl:"app/tenant/tenant-location.html",controller:"TenantLocationCtrl",controllerAs:'tenantLocationCtrl',ncyBreadcrumb:{label:'{{ tenantLocationCtrl.tenantName }}  / {{ tenantLocationCtrl.locationName }}',parent:'tenants'}});$stateProvider.state("addLocation",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/tenants/:tenantKey/location",templateUrl:"app/tenant/tenant-location.html",controller:"TenantLocationCtrl",controllerAs:'tenantLocationCtrl',ncyBreadcrumb:{label:'{{ tenantLocationCtrl.tenantName }}  / Location',parent:'tenants'}});$stateProvider.state("devices",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/devices",templateUrl:"app/device/devices-listing.html",controller:"DevicesListingCtrl",controllerAs:'devicesListingCtrl',ncyBreadcrumb:{label:'Devices'}});$stateProvider.state("editDevice",{resolve:{identity:function identity(IdentityService){return IdentityService.getIdentity();},authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/devices/:deviceKey?tenantKey?fromDevices",templateUrl:"app/device/device-detail.html",ncyBreadcrumb:{label:'{{ deviceDetailsCtrl.currentDevice.key }}',parent:'devices'},controller:'DeviceDetailsCtrl',function:function _function($scope,$stateParams){$scope.tenantKey=$stateParams.tenantKey;return;},controllerAs:'deviceDetailsCtrl'});$stateProvider.state("proof",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/proof",templateUrl:"app/proof/main.html",controller:"ProofOfPlayCtrl",controllerAs:'vm',ncyBreadcrumb:{label:'Proof of Play'}});$stateProvider.state("proofDetail",{resolve:{authenticated:function authenticated(AuthorizationService){return AuthorizationService.authenticated();}},url:"/proof/:tenant",templateUrl:"app/proof/detail.html",controller:"ProofOfPlayCtrl",controllerAs:'vm',ncyBreadcrumb:{label:'Proof of Play'}});$stateProvider.state("admin",{resolve:{isAdmin:function isAdmin(AuthorizationService){return AuthorizationService.isAdminOrDistributorAdmin();}},url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl",controllerAs:'vm',ncyBreadcrumb:{label:'Admin'}});$urlRouterProvider.otherwise('/sign_in');RestangularProvider.setBaseUrl('/api/v1');RestangularProvider.addResponseInterceptor(function(data,operation,resourceType,url,response,deferred){var result=data;// Uncomment this for pagination support when using PagingListHandlerMixin on the Python side.
//    if resourceType == 'devices' and operation = 'getList' and url == '/api/v1/devices'
//      result = data.objects
return result;});return RestangularProvider.setRestangularFields({id:'key'});});})();(function(){var app=angular.module('skykitProvisioning');app.run(function(StorageService,Restangular,$location,$injector,$rootScope,$timeout){app.constant("moment",moment);var stateChangeWatch=function stateChangeWatch(){var state=$injector.get('$state');return $rootScope.$on('$stateChangeError',function(event,toState,toParams,fromState,fromParams,error){if(error[0]==="authError"){return state.go(error[1]);}});};$timeout(stateChangeWatch,500);return Restangular.addRequestInterceptor(function(elem,operation,what,url){var authToken='6C346588BD4C6D722A1165B43C51C';if($location.host().indexOf('provisioning-gamestop')>-1){authToken='5XZHBF3mOwqJlYAlG1NeeWX0Cb72g';}Restangular.setDefaultHeaders({'Content-Type':'application/json','Accept':'application/json','Authorization':authToken,'X-Provisioning-User':StorageService.get('userKey'),'X-Provisioning-Distributor':StorageService.get('currentDistributorKey')});if(operation==='remove'){return undefined;}return elem;});});app.factory('RequestInterceptor',function(StorageService,$location){var interceptor={request:function request(config){var gs='5XZHBF3mOwqJlYAlG1NeeWX0Cb72g';var prod='6C346588BD4C6D722A1165B43C51C';config.headers={'Content-Type':'application/json','Accept':'application/json','Authorization':$location.host().indexOf('provisioning-gamestop')>-1?gs:prod,'X-Provisioning-User':StorageService.get('userKey'),'X-Provisioning-User-Identifier':StorageService.get('userEmail'),'X-Provisioning-Distributor':StorageService.get('currentDistributorKey')};return config;}};return interceptor;});app.config(function($httpProvider){return $httpProvider.interceptors.push('RequestInterceptor');});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("ProofOfPlayMultiDisplayCtrl",function(ProofPlayService,$stateParams,$state,ToastsService){var vm=this;vm.radioButtonChoices={group1:'By Date',group2:'Summarized',selection:null};vm.dateTimeSelection={start:null,end:null};vm.formValidity={start_date:false,end_date:false,displays:false};vm.tenant=$stateParams.tenant;vm.no_cache=true;vm.loading=true;vm.disabled=true;vm.disabledTenant=true;vm.selected_displays=[];vm.initialize=function(){return ProofPlayService.getAllDisplays(vm.tenant).then(function(data){vm.loading=false;vm.displays=data.data.devices;if(vm.displays.length>0){return vm.had_some_items=true;}else{return vm.had_some_items=false;}});};vm.refreshDisplays=function(){vm.searchText='';vm.selectedItem='';vm.loading=true;vm.disabled=true;vm.selected_displays=[];ProofPlayService.proofplayCache.removeAll();return vm.initialize();};vm.addToSelectedDisplays=function(searchText){if(vm.isDisplayValid(searchText)){vm.selected_displays.push(searchText);var index=vm.displays.indexOf(searchText);vm.displays.splice(index,1);vm.searchText='';}vm.areDisplaysValid();return vm.isDisabled();};vm.querySearch=function(displays,searchText){return ProofPlayService.querySearch(displays,searchText);};vm.isRadioValid=function(selection){vm.formValidity.type=selection;return vm.isDisabled();};vm.isDisplayValid=function(searchText){if(__in__(searchText,vm.displays)){if(!__in__(searchText,vm.selected_displays)){return true;}else{return false;}}else{return false;}};vm.areDisplaysValid=function(){vm.formValidity.displays=vm.selected_displays.length>0;return vm.isDisabled();};vm.isStartDateValid=function(start_date){vm.formValidity.start_date=start_date instanceof Date;return vm.isDisabled();};vm.isEndDateValid=function(end_date){vm.formValidity.end_date=end_date instanceof Date;return vm.isDisabled();};vm.removeFromSelectedDisplay=function(item){var index=vm.selected_displays.indexOf(item);vm.selected_displays.splice(index,1);vm.displays.push(item);vm.areDisplaysValid();return vm.isDisabled();};vm.isDisabled=function(){if(vm.formValidity.start_date&&vm.formValidity.end_date&&vm.formValidity.displays&&vm.formValidity.type){vm.disabled=false;return vm.final={start_date_unix:moment(vm.dateTimeSelection.start).unix(),end_date_unix:moment(vm.dateTimeSelection.end).unix(),displays:vm.selected_displays,type:vm.radioButtonChoices.selection};}else{return vm.disabled=true;}};vm.submit=function(){if(vm.final.type==="1"){return ProofPlayService.downloadCSVForMultipleDevicesByDate(vm.final.start_date_unix,vm.final.end_date_unix,vm.final.displays,vm.tenant);}else{return ProofPlayService.downloadCSVForMultipleDevicesSummarized(vm.final.start_date_unix,vm.final.end_date_unix,vm.final.displays,vm.tenant);}};vm.tenants=null;vm.currentTenant=vm.tenant;vm.initialize_tenant_select=function(){return ProofPlayService.getAllTenants().then(function(data){return vm.tenants=data.data.tenants;});};vm.submitTenant=function(tenant){if(tenant!==vm.currentTenant){$state.go('proofDetail',{tenant:tenant});return ToastsService.showSuccessToast('Proof of Play reporting set to '+tenant);}else{return ToastsService.showErrorToast('Proof of Play reporting is already set to '+tenant);}};vm.querySearch=function(resources,searchText){return ProofPlayService.querySearch(resources,searchText);};vm.isSelectionValid=function(search){if(__in__(search,vm.tenants)){return vm.disabledTenant=false;}else{return vm.disabledTenant=true;}};return vm;});function __in__(needle,haystack){return haystack.indexOf(needle)>=0;}})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("ProofOfPlayMultiLocationCtrl",function(ProofPlayService,$stateParams,$state,ToastsService){var vm=this;vm.radioButtonChoices={group1:'By Device',group2:'Summarized',selection:null};vm.dateTimeSelection={start:null,end:null};vm.formValidity={start_date:false,end_date:false,locations:false};vm.tenant=$stateParams.tenant;vm.no_cache=true;vm.loading=true;vm.disabled=true;vm.disabledTenant=true;vm.selected_locations=[];vm.initialize=function(){return ProofPlayService.getAllLocations(vm.tenant).then(function(data){vm.loading=false;vm.locations=data.data.locations;if(vm.locations.length>0){return vm.had_some_items=true;}else{return vm.had_some_items=false;}});};vm.refreshLocations=function(){vm.searchText='';vm.selectedItem='';vm.loading=true;vm.disabled=true;vm.selected_locations=[];ProofPlayService.proofplayCache.removeAll();return vm.initialize();};vm.addToSelectedLocations=function(searchText){if(vm.isLocationValid(searchText)){vm.selected_locations.push(searchText);var index=vm.locations.indexOf(searchText);vm.locations.splice(index,1);vm.searchText='';}vm.areLocationsValid();return vm.isDisabled();};vm.querySearch=function(locations,searchText){return ProofPlayService.querySearch(locations,searchText);};vm.isRadioValid=function(selection){vm.formValidity.type=selection;return vm.isDisabled();};vm.isLocationValid=function(searchText){if(__in__(searchText,vm.locations)){if(!__in__(searchText,vm.selected_locations)){return true;}else{return false;}}else{return false;}};vm.areLocationsValid=function(){vm.formValidity.locations=vm.selected_locations.length>0;return vm.isDisabled();};vm.isStartDateValid=function(start_date){vm.formValidity.start_date=start_date instanceof Date;return vm.isDisabled();};vm.isEndDateValid=function(end_date){vm.formValidity.end_date=end_date instanceof Date;return vm.isDisabled();};vm.removeFromSelectedLocation=function(item){var index=vm.selected_locations.indexOf(item);vm.selected_locations.splice(index,1);vm.locations.push(item);vm.areLocationsValid();return vm.isDisabled();};vm.isDisabled=function(){if(vm.formValidity.start_date&&vm.formValidity.end_date&&vm.formValidity.locations&&vm.formValidity.type){vm.disabled=false;return vm.final={start_date_unix:moment(vm.dateTimeSelection.start).unix(),end_date_unix:moment(vm.dateTimeSelection.end).unix(),locations:vm.selected_locations,type:vm.radioButtonChoices.selection};}else{return vm.disabled=true;}};vm.submit=function(){if(vm.final.type==="1"){return ProofPlayService.downloadCSVForMultipleLocationsByDevice(vm.final.start_date_unix,vm.final.end_date_unix,vm.final.locations,vm.tenant);}else{return ProofPlayService.downloadCSVForMultipleLocationsSummarized(vm.final.start_date_unix,vm.final.end_date_unix,vm.final.locations,vm.tenant);}};vm.tenants=null;vm.currentTenant=vm.tenant;vm.initialize_tenant_select=function(){return ProofPlayService.getAllTenants().then(function(data){return vm.tenants=data.data.tenants;});};vm.querySearch=function(resources,searchText){return ProofPlayService.querySearch(resources,searchText);};vm.isSelectionValid=function(search){if(__in__(search,vm.tenants)){return vm.disabledTenant=false;}else{return vm.disabledTenant=true;}};vm.submitTenant=function(tenant){if(tenant!==vm.currentTenant){$state.go('proofDetail',{tenant:tenant});return ToastsService.showSuccessToast('Proof of Play reporting set to '+tenant);}else{return ToastsService.showErrorToast('Proof of Play reporting is already set to '+tenant);}};return vm;});function __in__(needle,haystack){return haystack.indexOf(needle)>=0;}})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("ProofOfPlayMultiResourceCtrl",function(ProofPlayService,$stateParams,$state,ToastsService){var vm=this;vm.radioButtonChoices={group1:'By Device',group2:'By Date',selection:null};vm.dateTimeSelection={start:null,end:null};vm.formValidity={start_date:false,end_date:false,resources:false};vm.tenant=$stateParams.tenant;vm.no_cache=true;vm.loading=true;vm.disabled=true;vm.disabledTenant=true;vm.selected_resources=[];vm.initialize=function(){return ProofPlayService.getAllResources(vm.tenant).then(function(data){vm.loading=false;vm.full_resource_map=data.data.resources;vm.resources=[];for(var i=0;i<data.data.resources.length;i++){var resource=data.data.resources[i];vm.resources.push(resource.resource_name);}if(vm.resources.length>0){return vm.had_some_items=true;}else{return vm.had_some_items=false;}});};vm.refreshResources=function(){vm.searchText='';vm.selectedItem='';vm.loading=true;vm.disabled=true;vm.selected_resources=[];ProofPlayService.proofplayCache.removeAll();return vm.initialize();};vm.addToSelectedResources=function(searchText){if(vm.isResourceValid(searchText)){vm.selected_resources.push(searchText);var index=vm.resources.indexOf(searchText);vm.resources.splice(index,1);vm.searchText='';}vm.areResourcesValid();return vm.isDisabled();};vm.querySearch=function(resources,searchText){return ProofPlayService.querySearch(resources,searchText);};vm.isRadioValid=function(selection){vm.formValidity.type=selection;return vm.isDisabled();};vm.isResourceValid=function(searchText){if(__in__(searchText,vm.resources)){if(!__in__(searchText,vm.selected_resources)){return true;}else{return false;}}else{return false;}};vm.areResourcesValid=function(){vm.formValidity.resources=vm.selected_resources.length>0;return vm.isDisabled();};vm.isStartDateValid=function(start_date){vm.formValidity.start_date=start_date instanceof Date;return vm.isDisabled();};vm.isEndDateValid=function(end_date){vm.formValidity.end_date=end_date instanceof Date;return vm.isDisabled();};vm.removeFromSelectedResource=function(item){var index=vm.selected_resources.indexOf(item);vm.selected_resources.splice(index,1);vm.resources.push(item);vm.areResourcesValid();return vm.isDisabled();};vm.isDisabled=function(){if(vm.formValidity.start_date&&vm.formValidity.end_date&&vm.formValidity.resources&&vm.formValidity.type){vm.disabled=false;return vm.final={start_date_unix:moment(vm.dateTimeSelection.start).unix(),end_date_unix:moment(vm.dateTimeSelection.end).unix(),resources:vm.selected_resources,type:vm.radioButtonChoices.selection};}else{return vm.disabled=true;}};vm.submit=function(){var resources_as_ids=[];for(var i=0;i<vm.final.resources.length;i++){var item=vm.final.resources[i];for(var j=0;j<vm.full_resource_map.length;j++){var each=vm.full_resource_map[j];if(each["resource_name"]===item){resources_as_ids.push(each["resource_identifier"]);}}}if(vm.final.type==="1"){return ProofPlayService.downloadCSVForMultipleResourcesByDevice(vm.final.start_date_unix,vm.final.end_date_unix,resources_as_ids,vm.tenant);}else{return ProofPlayService.downloadCSVForMultipleResourcesByDate(vm.final.start_date_unix,vm.final.end_date_unix,resources_as_ids,vm.tenant);}};vm.tenants=null;vm.currentTenant=vm.tenant;vm.initialize_tenant_select=function(){return ProofPlayService.getAllTenants().then(function(data){return vm.tenants=data.data.tenants;});};vm.querySearch=function(resources,searchText){return ProofPlayService.querySearch(resources,searchText);};vm.isSelectionValid=function(search){if(__in__(search,vm.tenants)){return vm.disabledTenant=false;}else{return vm.disabledTenant=true;}};vm.submitTenant=function(tenant){if(tenant!==vm.currentTenant){$state.go('proofDetail',{tenant:tenant});return ToastsService.showSuccessToast('Proof of Play reporting set to '+tenant);}else{return ToastsService.showErrorToast('Proof of Play reporting is already set to '+tenant);}};return vm;});function __in__(needle,haystack){return haystack.indexOf(needle)>=0;}})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("ProofOfPlayCtrl",function(ProofPlayService,$stateParams,$state,ToastsService){var vm=this;vm.resource={title:"Resource Report"};vm.location={title:"Location Report"};vm.display={title:"Display Report"};vm.chosen_tenant=null;vm.tenants=null;vm.disabled=true;vm.initialize=function(){return ProofPlayService.getAllTenants().then(function(data){return vm.tenants=data.data.tenants;});};vm.querySearch=function(resources,searchText){return ProofPlayService.querySearch(resources,searchText);};vm.isSelectionValid=function(search){if(__in__(search,vm.tenants)){return vm.disabled=false;}else{return vm.disabled=true;}};vm.submitTenant=function(tenant){if(tenant){vm.chosen_tenant=tenant;return $state.go('proofDetail',{tenant:vm.chosen_tenant});}};vm.refreshTenants=function(){vm.tenants=null;var url=ProofPlayService.makeHTTPURL("/retrieve_my_tenants",'');ProofPlayService.proofplayCache.remove(url);return vm.initialize();};return vm;});function __in__(needle,haystack){return haystack.indexOf(needle)>=0;}})();angular.module('skykitProvisioning').factory('AdminService',function(Restangular){return new(function(){function AdminService(){_classCallCheck(this,AdminService);this.USER_SERVICE="users";this.DISTRIBUTOR_SERVICE="distributors";}_createClass(AdminService,[{key:'makeDistributor',value:function makeDistributor(distributor,admin_email){var payload={distributor:distributor,admin_email:admin_email};var promise=Restangular.oneUrl(this.DISTRIBUTOR_SERVICE,'/api/v1/distributors').customPOST(payload);return promise;}},{key:'addUserToDistributor',value:function addUserToDistributor(userEmail,distributor,distributorAdmin){var payload={user_email:userEmail,distributor:distributor,distributor_admin:distributorAdmin};var promise=Restangular.oneUrl(this.USER_SERVICE,"/api/v1/users").customPOST(payload);return promise;}},{key:'getUsersOfDistributor',value:function getUsersOfDistributor(distributorKey){var promise=Restangular.oneUrl(this.DISTRIBUTOR_SERVICE,'/api/v1/analytics/distributors/'+distributorKey+'/users').get();return promise;}},{key:'getAllDistributors',value:function getAllDistributors(){var promise=Restangular.oneUrl(this.DISTRIBUTOR_SERVICE,"/api/v1/distributors").get();return promise;}}]);return AdminService;}())();});angular.module('skykitProvisioning').factory('AuthorizationService',function(SessionsService,$q){return new(function(){function AuthorizationService(){_classCallCheck(this,AuthorizationService);}_createClass(AuthorizationService,[{key:'authenticated',value:function authenticated(){var deferred=$q.defer();var userKey=SessionsService.getUserKey();if(userKey){deferred.resolve(true);}else{deferred.reject(["authError",'sign_in']);}return deferred.promise;}},{key:'notAuthenticated',value:function notAuthenticated(){var deferred=$q.defer();var userKey=SessionsService.getUserKey();if(!userKey){deferred.resolve(true);}else{deferred.reject(["authError",'home']);}return deferred.promise;}},{key:'isAdminOrDistributorAdmin',value:function isAdminOrDistributorAdmin(){var deferred=$q.defer();var admin=SessionsService.getIsAdmin();var distributorAdmin=SessionsService.getDistributorsAsAdmin();var hasAtLeastOneDistributorAdmin=false;if(distributorAdmin&&distributorAdmin.length>0){hasAtLeastOneDistributorAdmin=true;}var userKey=SessionsService.getUserKey();if(!userKey){deferred.reject('sign_in');}else if(!admin&&!hasAtLeastOneDistributorAdmin){deferred.reject(["authError",'home']);}else{deferred.resolve(true);}return deferred.promise;}}]);return AuthorizationService;}())();});angular.module('skykitProvisioning').factory('CommandsService',function(Restangular){return new(function(){function CommandsService(){_classCallCheck(this,CommandsService);this.SERVICE_NAME='devices';}_createClass(CommandsService,[{key:'reset',value:function reset(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/reset').post();return promise;}},{key:'contentDelete',value:function contentDelete(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/content-delete').post();return promise;}},{key:'contentUpdate',value:function contentUpdate(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/content-update').post();return promise;}},{key:'updateDevice',value:function updateDevice(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/refresh-device-representation').post();return promise;}},{key:'toggleDiagnostics',value:function toggleDiagnostics(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/diagnostics').post();return promise;}},{key:'powerOn',value:function powerOn(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/power-on').post();return promise;}},{key:'powerOff',value:function powerOff(key){var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key+'/commands/power-off').post();return promise;}},{key:'volume',value:function volume(key,_volume){var payload={volume:_volume};var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key).customPOST(payload,'commands/volume');return promise;}},{key:'custom',value:function custom(key,command){var payload={command:command};var promise=Restangular.oneUrl(this.SERVICE_NAME,'api/v1/devices/'+key).customPOST(payload,'commands/custom');return promise;}}]);return CommandsService;}())();});angular.module('skykitProvisioning').factory('DateManipulationService',function(){return new(function(){function DateManipulationService(){_classCallCheck(this,DateManipulationService);}_createClass(DateManipulationService,[{key:'convertToMomentIfNotAlready',value:function convertToMomentIfNotAlready(date){if(!moment.isMoment(date)){return moment(new Date(date));}else{return date;}}},{key:'createFormattedStartAndEndDateFromToday',value:function createFormattedStartAndEndDateFromToday(daysBack){var startTime=moment().format('YYYY-MM-DD');var startTimeMidNight=moment(startTime,'YYYY-MM-DD').format('YYYY-MM-DD hh:mm A');var startTimeEndOfDay=moment(startTimeMidNight,'YYYY-MM-DD hh:mm A').add(1,'day').subtract(60,'seconds').format('YYYY-MM-DD hh:mm A');var endTime=moment().subtract(30,'days').format('YYYY-MM-DD');var endTimeMidNight=moment(endTime,'YYYY-MM-DD').format('YYYY-MM-DD hh:mm A');return[endTimeMidNight,startTimeEndOfDay];}},{key:'generateLocalFromUTC',value:function generateLocalFromUTC(UTCTime){var localTime=moment.utc(UTCTime).toDate();return moment(localTime).format('YYYY-MM-DD hh:mm:ss A');}}]);return DateManipulationService;}())();});angular.module('skykitProvisioning').factory('DevicesService',function($log,Restangular,$q,CacheFactory,$http){var url;var url;return new(function(){function DevicesService(){var _this=this;_classCallCheck(this,DevicesService);this.SERVICE_NAME='devices';this.uriBase='v1/devices';if(!CacheFactory.get('deviceCache')){this.deviceCache=CacheFactory('deviceCache',{maxAge:60*60*1000,deleteOnExpire:'aggressive',storageMode:'localStorage',onExpire:function onExpire(key,value){$http.get(key).success(function(data){_this.deviceCache.put(key,data);return;});return;}});}if(!CacheFactory.get('deviceByTenantCache')){this.deviceByTenantCache=CacheFactory('deviceByTenantCache',{maxAge:60*60*1000,deleteOnExpire:'aggressive',storageMode:'localStorage',onExpire:function onExpire(key,value){$http.get(key).success(function(data){_this.deviceByTenantCache.put(key,data);return;});return;}});}}_createClass(DevicesService,[{key:'getDeviceByMacAddress',value:function getDeviceByMacAddress(macAddress){var url='api/v1/devices?mac_address='+macAddress;return Restangular.oneUrl('api/v1/devices',url).get();}},{key:'getDeviceByKey',value:function getDeviceByKey(deviceKey){var url='api/v1/devices/'+deviceKey;var promise=Restangular.oneUrl(this.SERVICE_NAME,url).get();return promise;}},{key:'getIssuesByKey',value:function getIssuesByKey(deviceKey,startEpoch,endEpoch,prev,next){prev=prev===undefined||null?null:prev;next=next===undefined||null?null:next;var url='/api/v1/devices/'+prev+'/'+next+'/'+deviceKey+'/issues?start='+startEpoch+'&end='+endEpoch;var promise=Restangular.oneUrl(this.SERVICE_NAME,url).get();return promise;}},{key:'getCommandEventsByKey',value:function getCommandEventsByKey(deviceKey,prev,next){prev=prev===undefined||null?null:prev;next=next===undefined||null?null:next;var url='/api/v1/player-command-events/'+prev+'/'+next+'/'+deviceKey;var promise=Restangular.oneUrl(this.SERVICE_NAME,url).get();return promise;}//#######################################################################
// TENANT VIEW
//#######################################################################
},{key:'getDevicesByTenant',value:function getDevicesByTenant(tenantKey,prev,next){var _this2=this;if(tenantKey!==undefined){var _ret=function(){var deferred=$q.defer();var url=_this2.makeDevicesByTenantURL(tenantKey,prev,next,false);if(!_this2.deviceByTenantCache.get(url)){var promise=Restangular.oneUrl(_this2.SERVICE_NAME,url).get();promise.then(function(data){_this2.deviceByTenantCache.put(url,data);return deferred.resolve(data);});}else{deferred.resolve(_this2.deviceByTenantCache.get(url));}return{v:deferred.promise};}();if((typeof _ret==='undefined'?'undefined':_typeof(_ret))==="object")return _ret.v;}}},{key:'getUnmanagedDevicesByTenant',value:function getUnmanagedDevicesByTenant(tenantKey,prev,next){var _this3=this;if(tenantKey!==undefined){var _ret2=function(){var deferred=$q.defer();var url=_this3.makeDevicesByTenantURL(tenantKey,prev,next,true);if(!_this3.deviceByTenantCache.get(url)){var promise=Restangular.oneUrl(_this3.SERVICE_NAME,url).get();promise.then(function(data){_this3.deviceByTenantCache.put(url,data);return deferred.resolve(data);});}else{deferred.resolve(_this3.deviceByTenantCache.get(url));}return{v:deferred.promise};}();if((typeof _ret2==='undefined'?'undefined':_typeof(_ret2))==="object")return _ret2.v;}}},{key:'searchDevicesByPartialSerialByTenant',value:function searchDevicesByPartialSerialByTenant(tenantKey,partial_serial,unmanaged){if(tenantKey!==undefined){var _url='api/v1/tenants/search/serial/'+tenantKey+'/'+partial_serial+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url).get();return promise;}}},{key:'searchDevicesByPartialMacByTenant',value:function searchDevicesByPartialMacByTenant(tenantKey,partial_mac,unmanaged){if(tenantKey!==undefined){var _url2='api/v1/tenants/search/mac/'+tenantKey+'/'+partial_mac+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url2).get();return promise;}}},{key:'matchDevicesByFullSerialByTenant',value:function matchDevicesByFullSerialByTenant(tenantKey,full_serial,unmanaged){if(tenantKey!==undefined){var _url3='api/v1/tenants/match/serial/'+tenantKey+'/'+full_serial+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url3).get();return promise;}}},{key:'matchDevicesByFullMacByTenant',value:function matchDevicesByFullMacByTenant(tenantKey,full_mac,unmanaged){if(tenantKey!==undefined){var _url4='api/v1/tenants/match/mac/'+tenantKey+'/'+full_mac+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url4).get();return promise;}}//#######################################################################
// DEVICES VIEW
//#######################################################################
},{key:'searchDevicesByPartialSerial',value:function searchDevicesByPartialSerial(distributorKey,partial_serial,unmanaged){if(distributorKey!==undefined){var _url5='api/v1/distributors/search/serial/'+distributorKey+'/'+partial_serial+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url5).get();return promise;}}},{key:'searchDevicesByPartialMac',value:function searchDevicesByPartialMac(distributorKey,partial_mac,unmanaged){if(distributorKey!==undefined){var _url6='api/v1/distributors/search/mac/'+distributorKey+'/'+partial_mac+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url6).get();return promise;}}},{key:'matchDevicesByFullSerial',value:function matchDevicesByFullSerial(distributorKey,full_serial,unmanaged){if(distributorKey!==undefined){var _url7='api/v1/distributors/match/serial/'+distributorKey+'/'+full_serial+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url7).get();return promise;}}},{key:'matchDevicesByFullMac',value:function matchDevicesByFullMac(distributorKey,full_mac,unmanaged){if(distributorKey!==undefined){var _url8='api/v1/distributors/match/mac/'+distributorKey+'/'+full_mac+'/'+unmanaged+'/devices';var promise=Restangular.oneUrl(this.SERVICE_NAME,_url8).get();return promise;}}},{key:'getDevicesByDistributor',value:function getDevicesByDistributor(distributorKey,prev,next){var _this4=this;if(distributorKey!==undefined){var _ret3=function(){var deferred=$q.defer();var url=_this4.makeDevicesByDistributorURL(distributorKey,prev,next,false);if(!_this4.deviceCache.get(url)){var promise=Restangular.oneUrl(_this4.SERVICE_NAME,url).get();promise.then(function(data){_this4.deviceCache.put(url,data);return deferred.resolve(data);});}else{deferred.resolve(_this4.deviceCache.get(url));}return{v:deferred.promise};}();if((typeof _ret3==='undefined'?'undefined':_typeof(_ret3))==="object")return _ret3.v;}}},{key:'getUnmanagedDevicesByDistributor',value:function getUnmanagedDevicesByDistributor(distributorKey,prev,next){var _this5=this;if(distributorKey!==undefined){var _ret4=function(){var deferred=$q.defer();var url=_this5.makeDevicesByDistributorURL(distributorKey,prev,next,true);if(!_this5.deviceCache.get(url)){var promise=Restangular.oneUrl(_this5.SERVICE_NAME,url).get();promise.then(function(data){_this5.deviceCache.put(url,data);return deferred.resolve(data);});}else{deferred.resolve(_this5.deviceCache.get(url));}return{v:deferred.promise};}();if((typeof _ret4==='undefined'?'undefined':_typeof(_ret4))==="object")return _ret4.v;}}},{key:'getDevices',value:function getDevices(){var promise=Restangular.all(this.SERVICE_NAME).getList();return promise;}},{key:'save',value:function save(device){if(device.key!==undefined){var promise=device.put();}else{var promise=Restangular.service('devices').post(device);}return promise;}},{key:'delete',value:function _delete(deviceKey){var promise=Restangular.one(this.SERVICE_NAME,deviceKey).remove();return promise;}},{key:'getPanelModels',value:function getPanelModels(){return[{'id':'None','displayName':'None'},{'id':'Sony-FXD40LX2F','displayName':'Sony FXD40LX2F'},{'id':'NEC-LCD4215','displayName':'NEC LCD4215'},{'id':'Phillips-BDL5560EL','displayName':'Phillips BDL5560EL'},{'id':'Panasonic-TH55LF6U','displayName':'Panasonic TH55LF6U'},{'id':'Sharp-PNE521','displayName':'Sharp PNE521'}];}},{key:'getPanelInputs',value:function getPanelInputs(){return[{'id':'None','parentId':'None'},{'id':'HDMI1','parentId':'Sony-FXD40LX2F'},{'id':'HDMI2','parentId':'Sony-FXD40LX2F'},{'id':'HDMI1','parentId':'Phillips-BDL5560EL'},{'id':'HDMI2','parentId':'Phillips-BDL5560EL'},{'id':'DVI','parentId':'Phillips-BDL5560EL'},{'id':'HDMI1','parentId':'Panasonic-TH55LF6U'},{'id':'HDMI2','parentId':'Panasonic-TH55LF6U'},{'id':'DVI','parentId':'Panasonic-TH55LF6U'},{'id':'HDMI1','parentId':'Sharp-PNE521'},{'id':'HDMI2','parentId':'Sharp-PNE521'},{'id':'DVI','parentId':'Sharp-PNE521'},{'id':'VGA','parentId':'NEC-LCD4215'},{'id':'DVI1','parentId':'NEC-LCD4215'}];}},{key:'makeDevicesByDistributorURL',value:function makeDevicesByDistributorURL(distributorKey,prev,next,unmanaged){return url='/api/v1/distributors/'+prev+'/'+next+'/'+distributorKey+'/devices?unmanaged='+unmanaged;}},{key:'makeDevicesByTenantURL',value:function makeDevicesByTenantURL(tenantKey,prev,next,unmanaged){return url='/api/v1/tenants/'+prev+'/'+next+'/'+tenantKey+'/devices?unmanaged='+unmanaged;}}]);return DevicesService;}())();});angular.module('skykitProvisioning').factory('DistributorsService',function(Restangular,$state,SessionsService,ProofPlayService,TenantsService,DevicesService){return new(function(){function DistributorsService(){_classCallCheck(this,DistributorsService);this.DISTRIBUTOR_SERVICE='distributors';}_createClass(DistributorsService,[{key:'save',value:function save(tenant){if(tenant.key!==undefined){var promise=tenant.put();}else{var promise=Restangular.service(this.DISTRIBUTOR_SERVICE).post(tenant);}return promise;}},{key:'fetchAll',value:function fetchAll(){var promise=Restangular.all(this.DISTRIBUTOR_SERVICE).getList();return promise;}},{key:'fetchAllByUser',value:function fetchAllByUser(userKey){if(userKey){var promise=Restangular.one('users',userKey).doGET(this.DISTRIBUTOR_SERVICE);return promise;}}},{key:'getByKey',value:function getByKey(key){var promise=Restangular.oneUrl(this.DISTRIBUTOR_SERVICE,'api/v1/distributors/'+key).get();return promise;}},{key:'delete',value:function _delete(entity){if(entity.key){var promise=Restangular.one(this.DISTRIBUTOR_SERVICE,entity.key).remove();return promise;}}},{key:'getByName',value:function getByName(name){var promise=Restangular.all(this.DISTRIBUTOR_SERVICE).getList({distributorName:name});return promise;}},{key:'getDomainsByKey',value:function getDomainsByKey(key){var promise=Restangular.oneUrl(this.DISTRIBUTOR_SERVICE,'api/v1/distributors/'+key+'/domains').get();return promise;}},{key:'switchDistributor',value:function switchDistributor(distributor){ProofPlayService.proofplayCache.removeAll();TenantsService.tenantCache.removeAll();DevicesService.deviceCache.removeAll();DevicesService.deviceByTenantCache.removeAll();SessionsService.setCurrentDistributorName(distributor.name);SessionsService.setCurrentDistributorKey(distributor.key);return $state.go('welcome');}}]);return DistributorsService;}())();});angular.module('skykitProvisioning').factory('DomainsService',function(Restangular){return new(function(){function DomainsService(){_classCallCheck(this,DomainsService);}_createClass(DomainsService,[{key:'save',value:function save(domain){if(domain.key!==undefined){var promise=domain.put();}else{var promise=Restangular.service('domains').post(domain);}return promise;}},{key:'fetchAllDomains',value:function fetchAllDomains(){var promise=Restangular.all('domains').getList();return promise;}},{key:'getDomainByKey',value:function getDomainByKey(domainKey){var promise=Restangular.oneUrl('domains','api/v1/domains/'+domainKey).get();return promise;}},{key:'delete',value:function _delete(domain){if(domain.key!==undefined){var promise=Restangular.one("domains",domain.key).remove();return promise;}}}]);return DomainsService;}())();});angular.module('skykitProvisioning').factory('IdentityService',function($log,Restangular){return new(function(){function IdentityService(){_classCallCheck(this,IdentityService);}_createClass(IdentityService,[{key:'getIdentity',value:function getIdentity(){return Restangular.oneUrl('identity').get();}}]);return IdentityService;}())();});angular.module('skykitProvisioning').factory('IntegrationEvents',function(Restangular){return new(function(){function IntegrationEvents(){_classCallCheck(this,IntegrationEvents);this.ENROLLMENT_EVENTS='integration_events/enrollment';}_createClass(IntegrationEvents,[{key:'getEnrollmentEvents',value:function getEnrollmentEvents(deviceKey){var query={deviceKey:deviceKey};return Restangular.all(this.ENROLLMENT_EVENTS).customGET('',query);}}]);return IntegrationEvents;}())();});angular.module('skykitProvisioning').factory('LocationsService',function(Restangular){var LocationsService=function(){function LocationsService(){_classCallCheck(this,LocationsService);}_createClass(LocationsService,[{key:'save',value:function save(location){if(location.key!==undefined){var promise=location.put();}else{var promise=Restangular.service('locations').post(location);}return promise;}},{key:'getLocationsByTenantKey',value:function getLocationsByTenantKey(tenantKey){var promise=Restangular.oneUrl('tenants','api/v1/tenants/'+tenantKey+'/locations').get();return promise;}},{key:'getLocationsByTenantKeyPaginated',value:function getLocationsByTenantKeyPaginated(tenantKey,prev,next){prev=prev===undefined||null?null:prev;next=next===undefined||null?null:next;var promise=Restangular.oneUrl('tenants','api/v1/tenants/'+tenantKey+'/'+prev+'/'+next+'/locations').get();return promise;}},{key:'getLocationByKey',value:function getLocationByKey(locationKey){var promise=Restangular.oneUrl('locations','api/v1/locations/'+locationKey).get();return promise;}}]);return LocationsService;}();return new LocationsService();});angular.module('skykitProvisioning').factory('ProgressBarService',function(ngProgressFactory){return new(function(){function ProgressBarService(){_classCallCheck(this,ProgressBarService);this.progressBar=ngProgressFactory.createInstance();}_createClass(ProgressBarService,[{key:'start',value:function start(){this.progressBar.setColor('#00FCFF');this.progressBar.setHeight('4px');return this.progressBar.start();}},{key:'complete',value:function complete(){return this.progressBar.complete();}}]);return ProgressBarService;}())();});angular.module('skykitProvisioning').factory('ProofPlayService',function($http,$q,$window,SessionsService,$stateParams,$state,ToastsService,CacheFactory){var url=void 0;return new(function(){function ProofPlayService(){var _this6=this;_classCallCheck(this,ProofPlayService);this.makeHTTPRequest=this.makeHTTPRequest.bind(this);this.uriBase='proofplay/api/v1';if(!CacheFactory.get('proofplayCache')){this.proofplayCache=CacheFactory('proofplayCache',{maxAge:60*60*1000,deleteOnExpire:'aggressive',storageMode:'localStorage',onExpire:function onExpire(key){$http.get(key).success(function(data){_this6.proofplayCache.put(key,data);return;});return;}});}}_createClass(ProofPlayService,[{key:'makeHTTPURL',value:function makeHTTPURL(where_to_go,tenant){return url=this.uriBase+where_to_go+tenant;}},{key:'makeHTTPRequest',value:function makeHTTPRequest(where_to_go,tenant){var _this7=this;var deferred=$q.defer();var url=this.makeHTTPURL(where_to_go,tenant);if(!this.proofplayCache.get(url)){var res=$http.get(url);res.then(function(data){_this7.proofplayCache.put(url,data);return deferred.resolve(data);});res.catch(function(err){return deferred.reject(err);});}else{deferred.resolve(this.proofplayCache.get(url));}return deferred.promise;}},{key:'getAllResources',value:function getAllResources(tenant){// the catch is only done here because 3 proof of play views are initilized at the same time
// so this catch will be done 3 times with 3 error messages if we add it to getAllDisplays and getAllLocations
var r=this.makeHTTPRequest("/retrieve_all_resources/",tenant);r.catch(function(err,data){var status=err.status;if(status===403){ToastsService.showErrorToast("You are not allowed to view this tenant!");$state.go('proof',{});}if(status===404){ToastsService.showErrorToast("You must select a tenant first!");return $state.go('proof',{});}});return r.then(function(data){return data;});}},{key:'getAllDisplays',value:function getAllDisplays(tenant){return this.makeHTTPRequest("/retrieve_all_displays/",tenant);}},{key:'getAllLocations',value:function getAllLocations(tenant){return this.makeHTTPRequest("/retrieve_all_locations/",tenant);}},{key:'getAllTenants',value:function getAllTenants(){return this.makeHTTPRequest("/retrieve_my_tenants",'');}},{key:'downloadCSVForMultipleResourcesByDate',value:function downloadCSVForMultipleResourcesByDate(start_date,end_date,resources,tenant){var allResources='';for(var i=0;i<resources.length;i++){var each=resources[i];allResources=allResources+"|"+each;}$window.open(this.uriBase+'/multi_resource_by_date/'+start_date+'/'+end_date+'/'+allResources+'/'+tenant+"/"+SessionsService.getCurrentDistributorKey(),'_blank');return true;}},{key:'downloadCSVForMultipleResourcesByDevice',value:function downloadCSVForMultipleResourcesByDevice(start_date,end_date,resources,tenant){var allResources='';for(var i=0;i<resources.length;i++){var each=resources[i];allResources=allResources+"|"+each;}$window.open(this.uriBase+'/multi_resource_by_device/'+start_date+'/'+end_date+'/'+allResources+'/'+tenant+"/"+SessionsService.getCurrentDistributorKey(),'_blank');return true;}},{key:'downloadCSVForMultipleDevicesSummarized',value:function downloadCSVForMultipleDevicesSummarized(start_date,end_date,devices,tenant){var allDevices='';for(var i=0;i<devices.length;i++){var each=devices[i];allDevices=allDevices+"|"+each;}$window.open(this.uriBase+'/multi_device_summarized/'+start_date+'/'+end_date+'/'+allDevices+'/'+tenant+"/"+SessionsService.getCurrentDistributorKey(),'_blank');return true;}},{key:'downloadCSVForMultipleDevicesByDate',value:function downloadCSVForMultipleDevicesByDate(start_date,end_date,devices,tenant){var allDevices='';for(var i=0;i<devices.length;i++){var each=devices[i];allDevices=allDevices+"|"+each;}$window.open(this.uriBase+'/multi_device_by_date/'+start_date+'/'+end_date+'/'+allDevices+'/'+tenant+"/"+SessionsService.getCurrentDistributorKey(),'_blank');return true;}},{key:'downloadCSVForMultipleLocationsByDevice',value:function downloadCSVForMultipleLocationsByDevice(start_date,end_date,locations,tenant){var allLocations='';for(var i=0;i<locations.length;i++){var each=locations[i];allLocations=allLocations+"|"+each;}$window.open(this.uriBase+'/multi_location_by_device/'+start_date+'/'+end_date+'/'+allLocations+'/'+tenant+"/"+SessionsService.getCurrentDistributorKey(),'_blank');return true;}},{key:'downloadCSVForMultipleLocationsSummarized',value:function downloadCSVForMultipleLocationsSummarized(start_date,end_date,locations,tenant){var allLocations='';for(var i=0;i<locations.length;i++){var each=locations[i];allLocations=allLocations+"|"+each;}$window.open(this.uriBase+'/multi_location_summarized/'+start_date+'/'+end_date+'/'+allLocations+'/'+tenant+"/"+SessionsService.getCurrentDistributorKey(),'_blank');return true;}},{key:'createFilterFor',value:function createFilterFor(query){query=angular.lowercase(query);return function(resource){resource=angular.lowercase(resource);return resource.indexOf(query)===0;};}},{key:'querySearch',value:function querySearch(resources,searchText){if(searchText){return resources.filter(this.createFilterFor(searchText));}else{return resources;}}}]);return ProofPlayService;}())();});angular.module('skykitProvisioning').factory('SessionsService',function($http,$log,StorageService,IdentityService,Restangular,$q){return new(function(){function SessionsService(){_classCallCheck(this,SessionsService);this.setIdentity=this.setIdentity.bind(this);this.uriBase='v1/sessions';}_createClass(SessionsService,[{key:'setDistributors',value:function setDistributors(distributors){return StorageService.set('distributors',distributors);}},{key:'setDistributorsAsAdmin',value:function setDistributorsAsAdmin(distributorsAsAdmin){return StorageService.set('distributorsAsAdmin',distributorsAsAdmin);}},{key:'setIsAdmin',value:function setIsAdmin(isAdmin){return StorageService.set('isAdmin',isAdmin);}},{key:'setUserKey',value:function setUserKey(value){return StorageService.set('userKey',value);}},{key:'setUserEmail',value:function setUserEmail(value){return StorageService.set('userEmail',value);}},{key:'setCurrentDistributorKey',value:function setCurrentDistributorKey(value){return StorageService.set('currentDistributorKey',value);}},{key:'setCurrentDistributorName',value:function setCurrentDistributorName(value){return StorageService.set('currentDistributorName',value);}},{key:'getUserKey',value:function getUserKey(){return StorageService.get('userKey');}},{key:'getUserEmail',value:function getUserEmail(){return StorageService.get('userEmail');}},{key:'getDistributors',value:function getDistributors(){return StorageService.get('distributors');}},{key:'getCurrentDistributorName',value:function getCurrentDistributorName(){return StorageService.get('currentDistributorName');}},{key:'getCurrentDistributorKey',value:function getCurrentDistributorKey(){return StorageService.get('currentDistributorKey');}},{key:'getDistributorsAsAdmin',value:function getDistributorsAsAdmin(){return StorageService.get('distributorsAsAdmin');}},{key:'getIsAdmin',value:function getIsAdmin(){return StorageService.get('isAdmin');}},{key:'login',value:function login(credentials){var _this8=this;var authenticationPayload={access_token:_.clone(credentials.access_token),authuser:_.clone(credentials.authuser),client_id:_.clone(credentials.client_id),code:_.clone(credentials.code),id_token:_.clone(credentials.id_token),scope:_.clone(credentials.scope),session_state:_.clone(credentials.session_state),state:_.clone(credentials.state),status:_.clone(credentials.status)};if(credentials.email&&credentials.password){authenticationPayload=credentials;}var promise=$http.post('/login',authenticationPayload);return promise.success(function(data){_this8.setUserKey(data.user.key);return _this8.setIdentity().then(function(){return data;});});}},{key:'setIdentity',value:function setIdentity(){var _this9=this;var deferred=$q.defer();var identityPromise=IdentityService.getIdentity();identityPromise.then(function(data){_this9.setDistributors(data['distributors']);_this9.setDistributorsAsAdmin(data['distributors_as_admin']);_this9.setIsAdmin(data['is_admin']);_this9.setUserEmail(data['email']);_this9.setIsAdmin(data["is_admin"]);return deferred.resolve();});return deferred.promise;}},{key:'removeUserInfo',value:function removeUserInfo(){return StorageService.removeAll();}}]);return SessionsService;}())();});angular.module('skykitProvisioning').factory('StorageService',function(){return new(function(){function StorageService(){_classCallCheck(this,StorageService);}_createClass(StorageService,[{key:'set',value:function set(key,value){return Lockr.set(key,value);}},{key:'get',value:function get(key){return Lockr.get(key);}},{key:'rm',value:function rm(key){return Lockr.rm(key);}},{key:'removeAll',value:function removeAll(){return Lockr.flush();}}]);return StorageService;}())();});angular.module('skykitProvisioning').factory('TenantsService',function(Restangular,CacheFactory,SessionsService){return new(function(){function TenantsService(){var _this10=this;_classCallCheck(this,TenantsService);if(!CacheFactory.get('tenantCache')){this.tenantCache=CacheFactory('tenantCache',{maxAge:60*60*1000,deleteOnExpire:'aggressive',storageMode:'localStorage',onExpire:function onExpire(key,value){$http.get(key).success(function(data){_this10.tenantCache.put(key,data);return;});return;}});}}_createClass(TenantsService,[{key:'save',value:function save(tenant){if(tenant.key!==undefined){var promise=tenant.put();}else{var promise=Restangular.service('tenants').post(tenant);}return promise;}},{key:'fetchAllTenants',value:function fetchAllTenants(){var promise=Restangular.all('tenants').getList();return promise;}},{key:'fetchAllTenantsPaginated',value:function fetchAllTenantsPaginated(page_size,offset){var url='api/v1/tenants/paginated/'+page_size+'/'+offset;var promise=Restangular.oneUrl('tenants',url).get();return promise;}},{key:'getTenantByKey',value:function getTenantByKey(tenantKey){var url='api/v1/tenants/'+tenantKey;var promise=Restangular.oneUrl('tenants',url).get();return promise;}},{key:'delete',value:function _delete(tenant){if(tenant.key!==undefined){var promise=Restangular.one("tenants",tenant.key).remove();return promise;}}}]);return TenantsService;}())();});angular.module('skykitProvisioning').factory('TimezonesService',function($http,$log,Restangular){var TimezonesService=function(){function TimezonesService(){_classCallCheck(this,TimezonesService);}_createClass(TimezonesService,[{key:'getUsTimezones',value:function getUsTimezones(){var promise=Restangular.oneUrl('timezones','api/v1/timezones/us').get();return promise;}},{key:'getAllTimezones',value:function getAllTimezones(){var promise=Restangular.oneUrl('timezones','api/v1/timezones/all').get();return promise;}},{key:'getCustomTimezones',value:function getCustomTimezones(){var promise=Restangular.oneUrl('timezones','api/v1/timezones/custom').get();return promise;}}]);return TimezonesService;}();return new TimezonesService();});angular.module('skykitProvisioning').factory('ToastsService',function(toastr){return new(function(){function ToastsService(){_classCallCheck(this,ToastsService);}_createClass(ToastsService,[{key:'showSuccessToast',value:function showSuccessToast(message){var title=arguments.length<=1||arguments[1]===undefined?'Success!':arguments[1];return toastr.success(message,title);}},{key:'showErrorToast',value:function showErrorToast(message){var title=arguments.length<=1||arguments[1]===undefined?'Error!':arguments[1];return toastr.error(message,title);}},{key:'showInfoToast',value:function showInfoToast(message){var title=arguments.length<=1||arguments[1]===undefined?'Information':arguments[1];return toastr.info(message,title);}}]);return ToastsService;}())();});angular.module('skykitProvisioning').factory('VersionsService',function(Restangular){return new(function(){function VersionsService(){_classCallCheck(this,VersionsService);}_createClass(VersionsService,[{key:'getVersions',value:function getVersions(){var promise=Restangular.oneUrl('versions').get();return promise;}}]);return VersionsService;}())();});(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('TenantAddCtrl',function($log,$location,TenantsService,DistributorsService,TimezonesService,$state,sweet,ProgressBarService,SessionsService){var vm=this;vm.gameStopServer=$location.host().indexOf('provisioning-gamestop')>-1;vm.currentTenant={key:undefined,name:undefined,tenant_code:undefined,admin_email:undefined,content_server_url:undefined,content_manager_base_url:undefined,domain_key:undefined,notification_emails:undefined,proof_of_play_logging:false,proof_of_play_url:undefined,active:true};vm.selectedDomain=undefined;vm.distributorDomains=[];vm.timezones=[];vm.selectedTimezone='America/Chicago';vm.initialize=function(){var timezonePromise=TimezonesService.getCustomTimezones();timezonePromise.then(function(data){return vm.timezones=data;});vm.currentDistributorKey=SessionsService.getCurrentDistributorKey();var distributorPromise=DistributorsService.getByKey(vm.currentDistributorKey);distributorPromise.then(function(data){vm.currentTenant.content_manager_base_url=data.content_manager_url;return vm.currentTenant.content_server_url=data.player_content_url;});var distributorDomainPromise=DistributorsService.getDomainsByKey(vm.currentDistributorKey);return distributorDomainPromise.then(function(domains){return vm.distributorDomains=domains;});};vm.onClickSaveButton=function(){ProgressBarService.start();vm.currentTenant.default_timezone=vm.selectedTimezone;vm.currentTenant.domain_key=vm.selectedDomain.key;var promise=TenantsService.save(vm.currentTenant);return promise.then(vm.onSuccessTenantSave,vm.onFailureTenantSave);};vm.onSuccessTenantSave=function(){ProgressBarService.complete();return $state.go('tenants');};vm.onFailureTenantSave=function(errorObject){ProgressBarService.complete();if(errorObject.status===409){return sweet.show('Oops...','Tenant code unavailable. Please modify tenant name to generate a unique tenant code.','error');}else{$log.error(errorObject);return sweet.show('Oops...','Unable to save the tenant.','error');}};vm.autoGenerateTenantCode=function(){if(!vm.currentTenant.key){var newTenantCode='';if(vm.currentTenant.name){newTenantCode=vm.currentTenant.name.toLowerCase();newTenantCode=newTenantCode.replace(/\s+/g,'_');newTenantCode=newTenantCode.replace(/\W+/g,'');}return vm.currentTenant.tenant_code=newTenantCode;}};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('TenantDetailsCtrl',function($stateParams,TenantsService,DomainsService,TimezonesService,DistributorsService,$state,sweet,ProgressBarService,ToastsService,SessionsService,$scope,$location){var vm=this;vm.gameStopServer=$location.host().indexOf('provisioning-gamestop')>-1;vm.currentTenant={key:undefined,name:undefined,tenant_code:undefined,admin_email:undefined,content_server_url:undefined,content_manager_base_url:undefined,domain_key:undefined,notification_emails:undefined,proof_of_play_logging:false,proof_of_play_url:undefined,active:true};vm.selectedDomain=undefined;vm.distributorDomains=[];vm.timezones=[];vm.selectedTimezone='America/Chicago';vm.editMode=!!$stateParams.tenantKey;if(vm.editMode){var tenantPromise=TenantsService.getTenantByKey($stateParams.tenantKey);tenantPromise.then(function(tenant){vm.currentTenant=tenant;return vm.onSuccessResolvingTenant(tenant);});}vm.initialize=function(){var timezonePromise=TimezonesService.getCustomTimezones();timezonePromise.then(function(data){return vm.timezones=data;});vm.currentDistributorKey=SessionsService.getCurrentDistributorKey();var distributorDomainPromise=DistributorsService.getDomainsByKey(vm.currentDistributorKey);return distributorDomainPromise.then(function(domains){return vm.distributorDomains=domains;});};vm.onSuccessResolvingTenant=function(tenant){vm.selectedTimezone=tenant.default_timezone;var domainPromise=DomainsService.getDomainByKey(tenant.domain_key);return domainPromise.then(function(data){return vm.selectedDomain=data;});};vm.onClickSaveButton=function(){ProgressBarService.start();vm.currentTenant.default_timezone=vm.selectedTimezone;vm.currentTenant.domain_key=vm.selectedDomain.key;var promise=TenantsService.save(vm.currentTenant);return promise.then(vm.onSuccessTenantSave,vm.onFailureTenantSave);};vm.onSuccessTenantSave=function(){ProgressBarService.complete();return ToastsService.showSuccessToast('We saved your tenant information.');};vm.onFailureTenantSave=function(errorObject){ProgressBarService.complete();if(errorObject.status===409){return sweet.show('Oops...','Tenant code unavailable. Please modify tenant name to generate a unique tenant code.','error');}else{return sweet.show('Oops...','Unable to save the tenant.','error');}};vm.editItem=function(item){return $state.go('editDevice',{deviceKey:item.key,tenantKey:$stateParams.tenantKey});};vm.autoGenerateTenantCode=function(){if(!vm.currentTenant.key){var newTenantCode='';if(vm.currentTenant.name){newTenantCode=vm.currentTenant.name.toLowerCase();newTenantCode=newTenantCode.replace(/\s+/g,'_');newTenantCode=newTenantCode.replace(/\W+/g,'');}return vm.currentTenant.tenant_code=newTenantCode;}};$scope.tabIndex=0;$scope.$watch('tabIndex',function(toTab,fromTab){if(toTab!==undefined){switch(toTab){case 0:return $state.go('tenantDetails',{tenantKey:$stateParams.tenantKey});case 1:return $state.go('tenantManagedDevices',{tenantKey:$stateParams.tenantKey});case 2:return $state.go('tenantUnmanagedDevices',{tenantKey:$stateParams.tenantKey});case 3:return $state.go('tenantLocations',{tenantKey:$stateParams.tenantKey});}}});return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('TenantLocationCtrl',function($stateParams,TenantsService,LocationsService,$state,sweet,ProgressBarService,ToastsService){var vm=this;vm.location={key:undefined};vm.tenantKey=$stateParams.tenantKey;vm.editMode=!!$stateParams.locationKey;if(vm.editMode){var locationPromise=LocationsService.getLocationByKey($stateParams.locationKey);locationPromise.then(function(data){vm.location=data;vm.tenantKey=data.tenantKey;vm.locationName=data.customerLocationName;return vm.fetchTenantName(vm.tenantKey);});}vm.initialize=function(){if(!vm.editMode){vm.fetchTenantName(vm.tenantKey);return vm.location={tenantKey:vm.tenantKey,active:true};}};vm.onClickSaveButton=function(){ProgressBarService.start();var promise=LocationsService.save(vm.location);if(vm.editMode){return promise.then(vm.onSuccessUpdatingLocation(vm.tenantKey),vm.onFailureSavingLocation);}else{return promise.then(vm.onSuccessSavingLocation,vm.onFailureSavingLocation);}};vm.onSuccessSavingLocation=function(){ProgressBarService.complete();ToastsService.showSuccessToast('We saved your location.');return setTimeout(function(){$state.go('tenantLocations',{tenantKey:$stateParams.tenantKey});return;},1000);};vm.onSuccessUpdatingLocation=function(tenant_key){ProgressBarService.complete();ToastsService.showSuccessToast('We updated your location.');return setTimeout(function(){$state.go('tenantLocations',{tenantKey:tenant_key});return;},1000);};vm.onFailureSavingLocation=function(response){ProgressBarService.complete();if(response.status===409){ToastsService.showErrorToast('Location code conflict. Unable to save your location.');return sweet.show('Oops...','Please change your customer location name. Location name must generate a unique location code.','error');}else{return ToastsService.showErrorToast('Unable to save your location.');}};vm.fetchTenantName=function(tenantKey){var tenantPromise=TenantsService.getTenantByKey(tenantKey);return tenantPromise.then(function(tenant){return vm.tenantName=tenant.name;});};vm.autoGenerateCustomerLocationCode=function(){if(!vm.location.key){var newCustomerLocationCode='';if(vm.location.customerLocationName){newCustomerLocationCode=vm.location.customerLocationName.toLowerCase();newCustomerLocationCode=newCustomerLocationCode.replace(/\s+/g,'_');newCustomerLocationCode=newCustomerLocationCode.replace(/\W+/g,'');}return vm.location.customerLocationCode=newCustomerLocationCode;}};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('TenantLocationsCtrl',function($scope,$stateParams,TenantsService,LocationsService,$state,ProgressBarService){var vm=this;var tenantKey=$stateParams.tenantKey;vm.currentTenant=undefined;$scope.tabIndex=3;$scope.$watch('tabIndex',function(selectedIndex){if(selectedIndex!==undefined){switch(selectedIndex){case 0:return $state.go('tenantDetails',{tenantKey:tenantKey});case 1:return $state.go('tenantManagedDevices',{tenantKey:tenantKey});case 2:return $state.go('tenantUnmanagedDevices',{tenantKey:tenantKey});case 3:return $state.go('tenantLocations',{tenantKey:tenantKey});}}});vm.getLocations=function(tenantKey,prev,next){ProgressBarService.start();var locationsPromise=LocationsService.getLocationsByTenantKeyPaginated(tenantKey,prev,next);return locationsPromise.then(function(data){vm.locations=data.locations;vm.next_cursor=data.next_cursor;vm.prev_cursor=data.prev_cursor;return ProgressBarService.complete();});};vm.paginateCall=function(forward){if(forward){return vm.getLocations(tenantKey,null,vm.next_cursor);}else{return vm.getLocations(tenantKey,vm.prev_cursor,null);}};vm.initialize=function(){vm.locations=[];var tenantPromise=TenantsService.getTenantByKey(tenantKey);tenantPromise.then(function(data){return vm.currentTenant=data;});return vm.getLocations(tenantKey);};vm.editItem=function(item){return $state.go('editLocation',{locationKey:item.key});};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('TenantManagedDevicesCtrl',function($scope,$stateParams,TenantsService,DevicesService,ProgressBarService,$state){var vm=this;vm.currentTenant={key:undefined,name:undefined,tenant_code:undefined,admin_email:undefined,content_server_url:undefined,content_manager_base_url:undefined,domain_key:undefined,notification_emails:undefined,proof_of_play_logging:false,active:true};vm.tenantDevices=[];vm.devicesPrev=null;vm.devicesNext=null;vm.selectedButton="Serial Number";vm.serialDevices={};vm.disabled=true;vm.macDevices={};vm.editMode=!!$stateParams.tenantKey;vm.tenantKey=$stateParams.tenantKey;vm.getManagedDevices=function(tenantKey,prev_cursor,next_cursor){ProgressBarService.start();var devicesPromise=DevicesService.getDevicesByTenant(tenantKey,prev_cursor,next_cursor);return devicesPromise.then(function(data){vm.devicesPrev=data["prev_cursor"];vm.devicesNext=data["next_cursor"];vm.tenantDevices=data["devices"];return ProgressBarService.complete();});};vm.refreshDevices=function(){vm.devicesPrev=null;vm.devicesNext=null;vm.tenantDevices=null;DevicesService.deviceByTenantCache.removeAll();return vm.getManagedDevices(vm.tenantKey,vm.devicesPrev,vm.devicesNext);};if(vm.editMode){var tenantPromise=TenantsService.getTenantByKey(vm.tenantKey);tenantPromise.then(function(tenant){return vm.currentTenant=tenant;});vm.getManagedDevices(vm.tenantKey,null,null);}$scope.tabIndex=1;$scope.$watch('tabIndex',function(toTab,fromTab){if(toTab!==undefined){switch(toTab){case 0:return $state.go('tenantDetails',{tenantKey:vm.tenantKey});case 1:return $state.go('tenantManagedDevices',{tenantKey:vm.tenantKey});case 2:return $state.go('tenantUnmanagedDevices',{tenantKey:vm.tenantKey});case 3:return $state.go('tenantLocations',{tenantKey:vm.tenantKey});}}});vm.editItem=function(item){return $state.go('editDevice',{deviceKey:item.key,tenantKey:vm.tenantKey,fromDevices:false});};vm.convertArrayToDictionary=function(theArray,mac){var Devices={};for(var i=0;i<theArray.length;i++){var item=theArray[i];if(mac){Devices[item.mac]=item;}else{Devices[item.serial]=item;}}return Devices;};vm.changeRadio=function(){vm.searchText='';vm.disabled=true;vm.serialDevices={};return vm.macDevices={};};vm.searchDevices=function(partial_search){if(partial_search){if(partial_search.length>2){if(vm.selectedButton==="Serial Number"){return DevicesService.searchDevicesByPartialSerialByTenant(vm.tenantKey,partial_search,false).then(function(res){var result=res["serial_number_matches"];vm.serialDevices=vm.convertArrayToDictionary(result,false);var deviceSerials=[];for(var i=0;i<result.length;i++){var each=result[i];deviceSerials.push(each.serial);}return deviceSerials;});}else{return DevicesService.searchDevicesByPartialMacByTenant(vm.tenantKey,partial_search,false).then(function(res){var result=res["mac_matches"];vm.macDevices=vm.convertArrayToDictionary(result,true);var deviceMacs=[];for(var i=0;i<result.length;i++){var each=result[i];deviceMacs.push(each.mac);}return deviceMacs;});}}else{return[];}}else{return[];}};vm.paginateCall=function(forward){if(forward){return vm.getManagedDevices(vm.tenantKey,null,vm.devicesNext);}else{return vm.getManagedDevices(vm.tenantKey,vm.devicesPrev,null);}};vm.prepareForEditView=function(searchText){var mac=vm.selectedButton==="MAC";if(mac){return vm.editItem(vm.macDevices[searchText]);}else{return vm.editItem(vm.serialDevices[searchText]);}};vm.controlOpenButton=function(isMatch){vm.disabled=!isMatch;return vm.loadingDisabled=false;};vm.isResourceValid=function(resource){if(resource){if(resource.length>2){var mac=vm.selectedButton==="MAC";vm.loadingDisabled=true;if(mac){return DevicesService.matchDevicesByFullMacByTenant(vm.tenantKey,resource,false).then(function(res){return vm.controlOpenButton(res["is_match"]);});}else{return DevicesService.matchDevicesByFullSerialByTenant(vm.tenantKey,resource,false).then(function(res){return vm.controlOpenButton(res["is_match"]);});}}else{return vm.controlOpenButton(false);}}else{return vm.controlOpenButton(false);}};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller('TenantUnmanagedDevicesCtrl',function($scope,$stateParams,TenantsService,DevicesService,ProgressBarService,$state){var vm=this;vm.currentTenant={key:undefined,name:undefined,tenant_code:undefined,admin_email:undefined,content_server_url:undefined,content_manager_base_url:undefined,domain_key:undefined,notification_emails:undefined,proof_of_play_logging:false,active:true};vm.tenantDevices=[];vm.devicesPrev=null;vm.devicesNext=null;vm.selectedButton="MAC";vm.serialDevices={};vm.disabled=true;vm.macDevices={};vm.editMode=!!$stateParams.tenantKey;vm.tenantKey=$stateParams.tenantKey;vm.getUnmanagedDevices=function(tenantKey,prev_cursor,next_cursor){ProgressBarService.start();var devicesPromise=DevicesService.getUnmanagedDevicesByTenant(tenantKey,prev_cursor,next_cursor);return devicesPromise.then(function(data){vm.devicesPrev=data["prev_cursor"];vm.devicesNext=data["next_cursor"];vm.tenantDevices=data["devices"];return ProgressBarService.complete();});};vm.refreshDevices=function(){vm.devicesPrev=null;vm.devicesNext=null;vm.tenantDevices=null;DevicesService.deviceByTenantCache.removeAll();return vm.getUnmanagedDevices(vm.tenantKey,vm.devicesPrev,vm.devicesNext);};if(vm.editMode){var tenantPromise=TenantsService.getTenantByKey(vm.tenantKey);tenantPromise.then(function(tenant){return vm.currentTenant=tenant;});vm.getUnmanagedDevices(vm.tenantKey,null,null);}$scope.tabIndex=2;$scope.$watch('tabIndex',function(toTab,fromTab){if(toTab!==undefined){switch(toTab){case 0:return $state.go('tenantDetails',{tenantKey:vm.tenantKey});case 1:return $state.go('tenantManagedDevices',{tenantKey:vm.tenantKey});case 2:return $state.go('tenantUnmanagedDevices',{tenantKey:vm.tenantKey});case 3:return $state.go('tenantLocations',{tenantKey:vm.tenantKey});}}});vm.editItem=function(item){return $state.go('editDevice',{deviceKey:item.key,tenantKey:vm.tenantKey,fromDevices:false});};vm.convertArrayToDictionary=function(theArray,mac){var Devices={};for(var i=0;i<theArray.length;i++){var item=theArray[i];if(mac){Devices[item.mac]=item;}else{Devices[item.serial]=item;}}return Devices;};vm.changeRadio=function(){vm.searchText='';vm.disabled=true;vm.serialDevices={};return vm.macDevices={};};vm.searchDevices=function(partial_search){if(partial_search){if(partial_search.length>2){if(vm.selectedButton==="Serial Number"){return DevicesService.searchDevicesByPartialSerialByTenant(vm.tenantKey,partial_search,true).then(function(res){var result=res["serial_number_matches"];vm.serialDevices=vm.convertArrayToDictionary(result,false);var deviceSerials=[];for(var i=0;i<result.length;i++){var each=result[i];deviceSerials.push(each.serial);}return deviceSerials;});}else{return DevicesService.searchDevicesByPartialMacByTenant(vm.tenantKey,partial_search,true).then(function(res){var result=res["mac_matches"];vm.macDevices=vm.convertArrayToDictionary(result,true);var deviceMacs=[];for(var i=0;i<result.length;i++){var each=result[i];deviceMacs.push(each.mac);}return deviceMacs;});}}else{return[];}}else{return[];}};vm.paginateCall=function(forward){if(forward){return vm.getUnmanagedDevices(vm.tenantKey,null,vm.devicesNext);}else{return vm.getUnmanagedDevices(vm.tenantKey,vm.devicesPrev,null);}};vm.prepareForEditView=function(searchText){var mac=vm.selectedButton==="MAC";if(mac){return vm.editItem(vm.macDevices[searchText]);}else{return vm.editItem(vm.serialDevices[searchText]);}};vm.controlOpenButton=function(isMatch){vm.disabled=!isMatch;return vm.loadingDisabled=false;};vm.isResourceValid=function(resource){if(resource){if(resource.length>2){var mac=vm.selectedButton==="MAC";vm.loadingDisabled=true;if(mac){return DevicesService.matchDevicesByFullMacByTenant(vm.tenantKey,resource,true).then(function(res){return vm.controlOpenButton(res["is_match"]);});}else{return DevicesService.matchDevicesByFullSerialByTenant(vm.tenantKey,resource,true).then(function(res){return vm.controlOpenButton(res["is_match"]);});}}else{return vm.controlOpenButton(false);}}else{return vm.controlOpenButton(false);}};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("TenantsCtrl",function($state,$log,TenantsService,ProgressBarService,sweet){var vm=this;vm.tenants=[];vm.getTenants=function(page_size,offset){vm.offset=offset;vm.loading=true;ProgressBarService.start();var promise=TenantsService.fetchAllTenantsPaginated(page_size,offset);return promise.then(function(response){return vm.getFetchSuccess(response);},function(response){return vm.getFetchFailure(response);});};vm.initialize=function(){vm.offset=0;return vm.getTenants(100,vm.offset);};vm.getFetchSuccess=function(response){vm.tenants=response.tenants;vm.total=response.total;vm.is_first_page=response.is_first_page;vm.is_last_page=response.is_last_page;ProgressBarService.complete();return vm.loading=false;};vm.getFetchFailure=function(response){ProgressBarService.complete();var errorMessage='Unable to fetch tenants. Error: '+response.status+' '+response.statusText+'.';return sweet.show('Oops...',errorMessage,'error');};vm.editItem=function(item){return $state.go('tenantDetails',{tenantKey:item.key});};vm.deleteItem=function(item){var callback=function callback(){var promise=TenantsService.delete(item);return promise.then(function(){return vm.initialize();});};return sweet.show({title:"Are you sure?",text:"This will permanently remove the tenant from the system.",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, remove the tenant!",closeOnConfirm:true},callback);};return vm;});})();(function(){var appModule=angular.module('skykitProvisioning');appModule.controller("WelcomeCtrl",function(VersionsService,$state,DistributorsService,SessionsService){var vm=this;vm.version_data=[];vm.loading=true;vm.proceedToSignIn=function(){return $state.go('sign_in');};vm.capitalizeFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1);};vm.giveOptionToChangeDistributor=function(){var distributorsPromise=DistributorsService.fetchAllByUser(SessionsService.getUserKey());return distributorsPromise.then(function(data){vm.has_multiple_distributors=data.length>1;return vm.loading=false;});};vm.changeDistributor=function(){return $state.go('distributor_selection');};vm.getVersion=function(){var promise=VersionsService.getVersions();return promise.then(function(data){return vm.version_data=data;});};vm.initialize=function(){vm.identity={key:SessionsService.getUserKey(),email:SessionsService.getUserEmail(),distributorKey:SessionsService.getCurrentDistributorKey(),distributorName:SessionsService.getCurrentDistributorName()};vm.giveOptionToChangeDistributor();if(!vm.identity.email){return $state.go("sign_in");}else{return vm.getVersion();}};return vm;});})();